/**
 * rpg-dice-roller - A dice roller that accepts standard dice notation
 *
 * @version v4.0.2
 * @license MIT
 * @author GreenImp <info@greenimp.co.uk> (http://greenimp.co.uk)
 * @link https://github.com/GreenImp/rpg-dice-roller
 */
function t(e,r,n,o){this.message=e,this.expected=r,this.found=n,this.location=o,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,t)}!function(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}(t,Error),t.buildMessage=function(t,e){var r={literal:function(t){return'"'+o(t.text)+'"'},class:function(t){var e,r="";for(e=0;e<t.parts.length;e++)r+=t.parts[e]instanceof Array?i(t.parts[e][0])+"-"+i(t.parts[e][1]):i(t.parts[e]);return"["+(t.inverted?"^":"")+r+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}function o(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function i(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}return"Expected "+function(t){var e,n,o,i=new Array(t.length);for(e=0;e<t.length;e++)i[e]=(o=t[e],r[o.type](o));if(i.sort(),i.length>0){for(e=1,n=1;e<i.length;e++)i[e-1]!==i[e]&&(i[n]=i[e],n++);i.length=n}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(t)+" but "+function(t){return t?'"'+o(t)+'"':"end of input"}(e)+" found."};var e=function(e,r){r=void 0!==r?r:{};var n,o,i,a,s={},u={Main:At},c=At,p=xt("{",!1),f=xt(",",!1),h=xt("}",!1),l=xt("d",!1),m=xt("%",!1),d=xt("dF",!1),y=xt(".",!1),g=/^[12]/,v=Nt(["1","2"],!1,!1),w=xt("!",!1),b=xt("p",!1),x=/^[lh]/,N=Nt(["l","h"],!1,!1),E=xt("k",!1),S=xt("r",!1),O=xt("o",!1),A=xt("cs",!1),j=xt("cf",!1),T=xt("s",!1),k=xt("a",!1),P=xt("f",!1),C=xt("!=",!1),M=xt("<=",!1),F=xt(">=",!1),_=xt("=",!1),I=xt(">",!1),D=xt("<",!1),L=xt("(",!1),J=xt(")",!1),R=function(t,e,r){return[t,...e,r]},q=xt("abs",!1),B=xt("ceil",!1),H=xt("cos",!1),W=xt("exp",!1),z=xt("floor",!1),U=xt("log",!1),$=xt("round",!1),V=xt("sign",!1),X=xt("sin",!1),Z=xt("sqrt",!1),G=xt("tan",!1),K=xt("pow",!1),Q=xt("-",!1),Y=/^[.]/,tt=Nt(["."],!1,!1),et=/^[1-9]/,rt=Nt([["1","9"]],!1,!1),nt=/^[0-9]/,ot=Nt([["0","9"]],!1,!1),it=function(){return parseInt(bt(),10)},at=xt("**",!1),st=xt("*",!1),ut=xt("^",!1),ct=xt("/",!1),pt=xt("+",!1),ft={type:"other",description:"whitespace"},ht=/^[ \t\n\r]/,lt=Nt([" ","\t","\n","\r"],!1,!1),mt=0,dt=0,yt=[{line:1,column:1}],gt=0,vt=[],wt=0;if("startRule"in r){if(!(r.startRule in u))throw new Error("Can't start parsing from rule \""+r.startRule+'".');c=u[r.startRule]}function bt(){return e.substring(dt,mt)}function xt(t,e){return{type:"literal",text:t,ignoreCase:e}}function Nt(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function Et(t){var r,n=yt[t];if(n)return n;for(r=t-1;!yt[r];)r--;for(n={line:(n=yt[r]).line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return yt[t]=n,n}function St(t,e){var r=Et(t),n=Et(e);return{start:{offset:t,line:r.line,column:r.column},end:{offset:e,line:n.line,column:n.column}}}function Ot(t){mt<gt||(mt>gt&&(gt=mt,vt=[]),vt.push(t))}function At(){return Mt()}function jt(){var t,r,n,o,i,a,u,c,l,m,d,y;if(t=mt,123===e.charCodeAt(mt)?(r="{",mt++):(r=s,0===wt&&Ot(p)),r!==s)if(Jt()!==s)if((n=Mt())!==s){for(o=[],i=mt,(a=Jt())!==s?(44===e.charCodeAt(mt)?(u=",",mt++):(u=s,0===wt&&Ot(f)),u!==s&&(c=Jt())!==s&&(l=Mt())!==s?i=a=[a,u,c,l]:(mt=i,i=s)):(mt=i,i=s);i!==s;)o.push(i),i=mt,(a=Jt())!==s?(44===e.charCodeAt(mt)?(u=",",mt++):(u=s,0===wt&&Ot(f)),u!==s&&(c=Jt())!==s&&(l=Mt())!==s?i=a=[a,u,c,l]:(mt=i,i=s)):(mt=i,i=s);if(o!==s)if((i=Jt())!==s)if(125===e.charCodeAt(mt)?(a="}",mt++):(a=s,0===wt&&Ot(h)),a!==s){for(u=[],c=kt();c!==s;)u.push(c),c=kt();u!==s?(dt=t,m=n,d=o,y=u,t=r={type:"group",notation:bt(),expressions:[m,...d.map(t=>t[3])],modifiers:Object.assign({},...y.map(t=>({[t.subType]:t})))}):(mt=t,t=s)}else mt=t,t=s;else mt=t,t=s;else mt=t,t=s}else mt=t,t=s;else mt=t,t=s;else mt=t,t=s;return t}function Tt(){var t,r,n,o,i,a;if(t=mt,(r=function(){var t,r;t=mt,(r=function(){var t,r,n,o;t=mt,(r=Ct())===s&&(r=null);r!==s?(100===e.charCodeAt(mt)?(n="d",mt++):(n=s,0===wt&&Ot(l)),n!==s&&(o=Ct())!==s?(dt=t,t=r={type:"dice",subType:"standard",qty:r||1,d:n,sides:o}):(mt=t,t=s)):(mt=t,t=s);return t}())===s&&(r=function(){var t,r,n,o;t=mt,(r=Ct())===s&&(r=null);r!==s?(100===e.charCodeAt(mt)?(n="d",mt++):(n=s,0===wt&&Ot(l)),n!==s?(37===e.charCodeAt(mt)?(o="%",mt++):(o=s,0===wt&&Ot(m)),o!==s?(dt=t,t=r={type:"dice",subType:"percentile",qty:r||1,d:n,sides:100}):(mt=t,t=s)):(mt=t,t=s)):(mt=t,t=s);return t}())===s&&(r=function(){var t,r,n,o,i,a;t=mt,(r=Ct())===s&&(r=null);r!==s?("dF"===e.substr(mt,2)?(n="dF",mt+=2):(n=s,0===wt&&Ot(d)),n!==s?(o=mt,46===e.charCodeAt(mt)?(i=".",mt++):(i=s,0===wt&&Ot(y)),i!==s?(g.test(e.charAt(mt))?(a=e.charAt(mt),mt++):(a=s,0===wt&&Ot(v)),a!==s?o=i=[i,a]:(mt=o,o=s)):(mt=o,o=s),o===s&&(o=null),o!==s?(dt=t,r={type:"dice",subType:"fudge",qty:r||1,d:n,sides:(u=o)?parseInt(u[1],10):2},t=r):(mt=t,t=s)):(mt=t,t=s)):(mt=t,t=s);var u;return t}());r!==s&&(dt=t,n=r,r=Object.assign(n,{notation:bt()}));var n;return t=r}())!==s){for(n=[],o=kt();o!==s;)n.push(o),o=kt();n!==s?(dt=t,i=r,a=n,t=r=Object.assign(i,{modifiers:Object.assign({},...a.map(t=>({[t.subType]:t})))})):(mt=t,t=s)}else mt=t,t=s;return t}function kt(){var t,r,n;return t=mt,(r=function(){var t,r,n,o,i;t=mt,33===e.charCodeAt(mt)?(r="!",mt++):(r=s,0===wt&&Ot(w));r!==s?(33===e.charCodeAt(mt)?(n="!",mt++):(n=s,0===wt&&Ot(w)),n===s&&(n=null),n!==s?(112===e.charCodeAt(mt)?(o="p",mt++):(o=s,0===wt&&Ot(b)),o===s&&(o=null),o!==s?((i=Pt())===s&&(i=null),i!==s?(dt=t,t=r={type:"modifier",subType:"explode",penetrate:!!o,compound:!!n,comparePoint:i}):(mt=t,t=s)):(mt=t,t=s)):(mt=t,t=s)):(mt=t,t=s);return t}())===s&&(r=function(){var t,r,n;t=mt,(r=Pt())!==s?((n=function(){var t,r,n;t=mt,102===e.charCodeAt(mt)?(r="f",mt++):(r=s,0===wt&&Ot(P));r!==s&&(n=Pt())!==s?(dt=t,t=r=n):(mt=t,t=s);return t}())===s&&(n=null),n!==s?(dt=t,t=r={type:"modifier",subType:"target",successCP:r,failureCP:n}):(mt=t,t=s)):(mt=t,t=s);return t}())===s&&(r=function(){var t,r,n,o;t=mt,100===e.charCodeAt(mt)?(r="d",mt++):(r=s,0===wt&&Ot(l));r!==s?(x.test(e.charAt(mt))?(n=e.charAt(mt),mt++):(n=s,0===wt&&Ot(N)),n===s&&(n=null),n!==s&&(o=It())!==s?(dt=t,t=r={type:"modifier",subType:"drop",end:n||"l",qty:o}):(mt=t,t=s)):(mt=t,t=s);return t}())===s&&(r=function(){var t,r,n,o;t=mt,107===e.charCodeAt(mt)?(r="k",mt++):(r=s,0===wt&&Ot(E));r!==s?(x.test(e.charAt(mt))?(n=e.charAt(mt),mt++):(n=s,0===wt&&Ot(N)),n===s&&(n=null),n!==s&&(o=It())!==s?(dt=t,t=r={type:"modifier",subType:"keep",end:n||"h",qty:o}):(mt=t,t=s)):(mt=t,t=s);return t}())===s&&(r=function(){var t,r,n,o;t=mt,114===e.charCodeAt(mt)?(r="r",mt++):(r=s,0===wt&&Ot(S));r!==s?(111===e.charCodeAt(mt)?(n="o",mt++):(n=s,0===wt&&Ot(O)),n===s&&(n=null),n!==s?((o=Pt())===s&&(o=null),o!==s?(dt=t,t=r={type:"modifier",subType:"re-roll",once:!!n,comparePoint:o}):(mt=t,t=s)):(mt=t,t=s)):(mt=t,t=s);return t}())===s&&(r=function(){var t,r,n;t=mt,"cs"===e.substr(mt,2)?(r="cs",mt+=2):(r=s,0===wt&&Ot(A));r!==s&&(n=Pt())!==s?(dt=t,t=r={type:"modifier",subType:"critical-success",comparePoint:n}):(mt=t,t=s);return t}())===s&&(r=function(){var t,r,n;t=mt,"cf"===e.substr(mt,2)?(r="cf",mt+=2):(r=s,0===wt&&Ot(j));r!==s&&(n=Pt())!==s?(dt=t,t=r={type:"modifier",subType:"critical-failure",comparePoint:n}):(mt=t,t=s);return t}())===s&&(r=function(){var t,r,n;t=mt,115===e.charCodeAt(mt)?(r="s",mt++):(r=s,0===wt&&Ot(T));r!==s?(97===e.charCodeAt(mt)?(n="a",mt++):(n=s,0===wt&&Ot(k)),n===s&&(100===e.charCodeAt(mt)?(n="d",mt++):(n=s,0===wt&&Ot(l))),n===s&&(n=null),n!==s?(dt=t,t=r={type:"modifier",subType:"sort",direction:n||"a"}):(mt=t,t=s)):(mt=t,t=s);return t}()),r!==s&&(dt=t,n=r,r=Object.assign(n,{notation:bt()})),t=r}function Pt(){var t,r,n;return t=mt,(r=function(){var t;"!="===e.substr(mt,2)?(t="!=",mt+=2):(t=s,0===wt&&Ot(C));t===s&&("<="===e.substr(mt,2)?(t="<=",mt+=2):(t=s,0===wt&&Ot(M)),t===s&&(">="===e.substr(mt,2)?(t=">=",mt+=2):(t=s,0===wt&&Ot(F)),t===s&&(61===e.charCodeAt(mt)?(t="=",mt++):(t=s,0===wt&&Ot(_)),t===s&&(62===e.charCodeAt(mt)?(t=">",mt++):(t=s,0===wt&&Ot(I)),t===s&&(60===e.charCodeAt(mt)?(t="<",mt++):(t=s,0===wt&&Ot(D)))))));return t}())!==s&&(n=_t())!==s?(dt=t,t=r={type:"compare-point",operator:r,value:n}):(mt=t,t=s),t}function Ct(){var t,r,n,o;return(t=It())===s&&(t=mt,40===e.charCodeAt(mt)?(r="(",mt++):(r=s,0===wt&&Ot(L)),r!==s&&Jt()!==s&&(n=Mt())!==s&&Jt()!==s?(41===e.charCodeAt(mt)?(o=")",mt++):(o=s,0===wt&&Ot(J)),o!==s?(dt=t,t=r=R(r,n,o)):(mt=t,t=s)):(mt=t,t=s)),t}function Mt(){var t,e,r,n,o,i,a,u,c,p;if(t=mt,(e=Ft())!==s){for(r=[],n=mt,(o=Jt())!==s&&(i=Lt())!==s&&(a=Jt())!==s&&(u=Ft())!==s?n=o=[o,i,a,u]:(mt=n,n=s);n!==s;)r.push(n),n=mt,(o=Jt())!==s&&(i=Lt())!==s&&(a=Jt())!==s&&(u=Ft())!==s?n=o=[o,i,a,u]:(mt=n,n=s);r!==s?(dt=t,c=e,p=r,c=Array.isArray(c)?c:[c],t=e=[...c,...p.map(([,t,,e])=>[t,e]).flat(2)]):(mt=t,t=s)}else mt=t,t=s;return t}function Ft(){var t,r,n,o;return(t=function(){var t,r,n,o,i,a,u;t=mt,"abs"===e.substr(mt,3)?(r="abs",mt+=3):(r=s,0===wt&&Ot(q));r===s&&("ceil"===e.substr(mt,4)?(r="ceil",mt+=4):(r=s,0===wt&&Ot(B)),r===s&&("cos"===e.substr(mt,3)?(r="cos",mt+=3):(r=s,0===wt&&Ot(H)),r===s&&("exp"===e.substr(mt,3)?(r="exp",mt+=3):(r=s,0===wt&&Ot(W)),r===s&&("floor"===e.substr(mt,5)?(r="floor",mt+=5):(r=s,0===wt&&Ot(z)),r===s&&("log"===e.substr(mt,3)?(r="log",mt+=3):(r=s,0===wt&&Ot(U)),r===s&&("round"===e.substr(mt,5)?(r="round",mt+=5):(r=s,0===wt&&Ot($)),r===s&&("sign"===e.substr(mt,4)?(r="sign",mt+=4):(r=s,0===wt&&Ot(V)),r===s&&("sin"===e.substr(mt,3)?(r="sin",mt+=3):(r=s,0===wt&&Ot(X)),r===s&&("sqrt"===e.substr(mt,4)?(r="sqrt",mt+=4):(r=s,0===wt&&Ot(Z)),r===s&&("tan"===e.substr(mt,3)?(r="tan",mt+=3):(r=s,0===wt&&Ot(G))))))))))));r!==s?(40===e.charCodeAt(mt)?(n="(",mt++):(n=s,0===wt&&Ot(L)),n!==s&&Jt()!==s&&(o=Mt())!==s&&Jt()!==s?(41===e.charCodeAt(mt)?(i=")",mt++):(i=s,0===wt&&Ot(J)),i!==s?(dt=t,c=o,r=[r+"(",...c,")"],t=r):(mt=t,t=s)):(mt=t,t=s)):(mt=t,t=s);var c;t===s&&(t=mt,"pow"===e.substr(mt,3)?(r="pow",mt+=3):(r=s,0===wt&&Ot(K)),r!==s?(40===e.charCodeAt(mt)?(n="(",mt++):(n=s,0===wt&&Ot(L)),n!==s&&Jt()!==s&&(o=Mt())!==s&&Jt()!==s?(44===e.charCodeAt(mt)?(i=",",mt++):(i=s,0===wt&&Ot(f)),i!==s&&Jt()!==s&&(a=Mt())!==s&&Jt()!==s?(41===e.charCodeAt(mt)?(u=")",mt++):(u=s,0===wt&&Ot(J)),u!==s?(dt=t,r=function(t,e,r){return[t+"(",...e,",",...r,")"]}(r,o,a),t=r):(mt=t,t=s)):(mt=t,t=s)):(mt=t,t=s)):(mt=t,t=s));return t}())===s&&(t=Tt())===s&&(t=_t())===s&&(t=mt,40===e.charCodeAt(mt)?(r="(",mt++):(r=s,0===wt&&Ot(L)),r!==s&&Jt()!==s&&(n=Mt())!==s&&Jt()!==s?(41===e.charCodeAt(mt)?(o=")",mt++):(o=s,0===wt&&Ot(J)),o!==s?(dt=t,t=r=R(r,n,o)):(mt=t,t=s)):(mt=t,t=s),t===s&&(t=jt())),t}function _t(){var t,r,n,o,i;return t=mt,45===e.charCodeAt(mt)?(r="-",mt++):(r=s,0===wt&&Ot(Q)),r===s&&(r=null),r!==s&&Dt()!==s?(n=mt,Y.test(e.charAt(mt))?(o=e.charAt(mt),mt++):(o=s,0===wt&&Ot(tt)),o!==s&&(i=Dt())!==s?n=o=[o,i]:(mt=n,n=s),n===s&&(n=null),n!==s?(dt=t,t=r=parseFloat(bt())):(mt=t,t=s)):(mt=t,t=s),t}function It(){var t,r,n,o;if(t=mt,et.test(e.charAt(mt))?(r=e.charAt(mt),mt++):(r=s,0===wt&&Ot(rt)),r!==s){for(n=[],nt.test(e.charAt(mt))?(o=e.charAt(mt),mt++):(o=s,0===wt&&Ot(ot));o!==s;)n.push(o),nt.test(e.charAt(mt))?(o=e.charAt(mt),mt++):(o=s,0===wt&&Ot(ot));n!==s?(dt=t,t=r=it()):(mt=t,t=s)}else mt=t,t=s;return t}function Dt(){var t,r,n;if(t=mt,r=[],nt.test(e.charAt(mt))?(n=e.charAt(mt),mt++):(n=s,0===wt&&Ot(ot)),n!==s)for(;n!==s;)r.push(n),nt.test(e.charAt(mt))?(n=e.charAt(mt),mt++):(n=s,0===wt&&Ot(ot));else r=s;return r!==s&&(dt=t,r=it()),t=r}function Lt(){var t,r;return t=mt,"**"===e.substr(mt,2)?(r="**",mt+=2):(r=s,0===wt&&Ot(at)),r!==s&&(dt=t,r="^"),(t=r)===s&&(42===e.charCodeAt(mt)?(t="*",mt++):(t=s,0===wt&&Ot(st)),t===s&&(94===e.charCodeAt(mt)?(t="^",mt++):(t=s,0===wt&&Ot(ut)),t===s&&(37===e.charCodeAt(mt)?(t="%",mt++):(t=s,0===wt&&Ot(m)),t===s&&(47===e.charCodeAt(mt)?(t="/",mt++):(t=s,0===wt&&Ot(ct)),t===s&&(43===e.charCodeAt(mt)?(t="+",mt++):(t=s,0===wt&&Ot(pt)),t===s&&(45===e.charCodeAt(mt)?(t="-",mt++):(t=s,0===wt&&Ot(Q)))))))),t}function Jt(){var t,r;for(wt++,t=[],ht.test(e.charAt(mt))?(r=e.charAt(mt),mt++):(r=s,0===wt&&Ot(lt));r!==s;)t.push(r),ht.test(e.charAt(mt))?(r=e.charAt(mt),mt++):(r=s,0===wt&&Ot(lt));return wt--,t===s&&(r=s,0===wt&&Ot(ft)),t}if((n=c())!==s&&mt===e.length)return n;throw n!==s&&mt<e.length&&Ot({type:"end"}),o=vt,i=gt<e.length?e.charAt(gt):null,a=gt<e.length?St(gt,gt+1):St(gt,gt),new t(t.buildMessage(o,i),o,i,a)};Array.prototype.flat||(Array.prototype.flat=function(){var t=arguments[0];return(t=void 0===t?1:Math.floor(t))<1?Array.prototype.slice.call(this):function t(e,r){for(var n=e.length>>>0,o=[],i=0;i<n;){if(i in e){var a=e[i];Array.isArray(a)&&r>0?o=o.concat(t(a,r-1)):o.push(a)}i++}return o}(this,t)}),Array.prototype.flatMap||(Array.prototype.flatMap=function(){return Array.prototype.map.apply(this,arguments).flat(1)});const r=Object.freeze({isNumeric:t=>!Array.isArray(t)&&!Number.isNaN(t)&&Number.isFinite(parseInt(t,10)),isBase64(t){try{return!(!t||btoa(atob(t))!==t)}catch(t){return!1}},isJson(t){try{let e=!!t&&JSON.parse(t);return!(!e||"object"!=typeof e)}catch(t){return!1}},generateNumber:(t,e)=>(t=t?parseInt(t,10):1,(e=e?parseInt(e,10):t)<=t?t:Math.floor(Math.random()*(e-t+1)+t)),get sumArray(){return t=>Array.isArray(t)?t.reduce((t,e)=>t+(this.isNumeric(e)?parseFloat(e):0),0):0},compareNumbers(t,e,r){let n;switch(t=parseFloat(t),e=parseFloat(e),r){case"=":case"==":n=t===e;break;case"<":n=t<e;break;case">":n=t>e;break;case"<=":n=t<=e;break;case">=":n=t>=e;break;case"!":case"!=":n=t!==e;break;default:n=!1}return n},toFixed:(t,e)=>parseFloat(parseFloat(t).toFixed(e||0))}),n=Object.freeze({JSON:0,BASE_64:1,OBJECT:2}),o=class{constructor(t){if(!t)throw new Error("Notation is required");this.notation=t,this.order=999}get name(){return this.constructor.name}run(t,e){return t}toJSON(){const{notation:t,name:e}=this;return{name:e,notation:t,type:"modifier"}}toString(){return this.notation}},i=(()=>{const t=Symbol("operator"),e=Symbol("value");return class{constructor(t,e){if(!t)throw new Error("ComparePoint: No compare operator specified");if(!e&&0!==e)throw new Error("ComparePoint: No compare value specified");this.operator=t,this.value=e}static isValidOperator(t){return"string"==typeof t&&/^(?:[<>!]?=|[<>])$/.test(t)}set operator(e){if(!this.constructor.isValidOperator(e))throw new Error(`ComparePoint: operator "${e}" is not valid`);this[t]=e}get operator(){return this[t]}set value(t){if(!r.isNumeric(t))throw new Error("ComparePoint: value must be numeric");this[e]=parseInt(t,10)}get value(){return this[e]}isMatch(t){return r.compareNumbers(t,this.value,this.operator)}toJSON(){const{operator:t,value:e}=this;return{operator:t,type:"compare-point",value:e}}toString(){return`${this.operator}${this.value}`}}})(),a=(()=>{const t=Symbol("compare-point");return class extends o{constructor(t,e){super(t),e&&(this.comparePoint=e)}get comparePoint(){return this[t]}set comparePoint(e){if(!(e instanceof i))throw TypeError("comparePoint must be instance of ComparePoint");this[t]=e}isComparePoint(t){return!!this.comparePoint&&this.comparePoint.isMatch(t)}toJSON(){const{comparePoint:t}=this;return Object.assign(super.toJSON(),{comparePoint:t})}}})(),s=(()=>{const t=Symbol("calculation-value"),e=Symbol("modifiers"),n=Symbol("initial-value"),o=Symbol("use-in-total"),i=Symbol("value");return class{constructor(t,e,o=!0){if(r.isNumeric(t))this[n]=parseInt(t,10);else{if(!t||"object"!=typeof t||Array.isArray(t))throw new Error("Result value is invalid: "+t);{const i=r.isNumeric(t.initialValue)?t.initialValue:t.value;if(!r.isNumeric(i))throw new Error("Result value is invalid: "+i);this[n]=parseInt(i,10),r.isNumeric(t.value)&&parseInt(t.value,10)!==this[n]&&(this.value=t.value),r.isNumeric(t.calculationValue)&&parseFloat(t.calculationValue)!==this.value&&(this.calculationValue=t.calculationValue),Array.isArray(t.modifiers)&&t.modifiers.length&&(e=t.modifiers),"boolean"==typeof t.useInTotal&&(o=t.useInTotal)}}this.modifiers=e||[],this.useInTotal=o}get calculationValue(){return r.isNumeric(this[t])?parseFloat(this[t]):this.value}set calculationValue(e){const n=r.isNumeric(e);if(e&&!n)throw new Error("Result calculation value is invalid: "+e);this[t]=n?parseFloat(e):null}get initialValue(){return this[n]}get modifierFlags(){return this.modifiers.reduce((t,e)=>{switch(e){case"compound":case"explode":e="!";break;case"critical-failure":e="__";break;case"critical-success":e="**";break;case"drop":e="d";break;case"penetrate":e="p";break;case"re-roll":e="r";break;case"re-roll-once":e="ro";break;case"target-failure":e="_";break;case"target-success":e="*"}return t+e},"")}get modifiers(){return this[e]||[]}set modifiers(t){if((t||0===t)&&(!Array.isArray(t)||t.some(t=>"string"!=typeof t)))throw new Error("Modifiers must be an array of modifier names: "+t);this[e]=t||[]}get useInTotal(){return!!this[o]}set useInTotal(t){this[o]=!!t}get value(){return r.isNumeric(this[i])?this[i]:this[n]}set value(t){if(!r.isNumeric(t))throw new Error("Result value is invalid: "+t);this[i]=parseInt(t,10)}toJSON(){const{calculationValue:t,initialValue:e,modifierFlags:r,modifiers:n,useInTotal:o,value:i}=this;return{calculationValue:t,initialValue:e,modifierFlags:r,modifiers:n,type:"result",useInTotal:o,value:i}}toString(){return this.value+this.modifierFlags}}})(),u=(()=>{const t=Symbol("compound"),e=Symbol("penetrate");return class extends a{constructor(r,n=null,o=!1,i=!1){super(r,n),this[t]=!!o,this[e]=!!i,this.order=1}get compound(){return this[t]}get penetrate(){return this[e]}run(t,e){if(e.min===e.max)throw new Error("Die must have more than 1 side to explode: "+e);return t.rolls=t.rolls.map(t=>{const n=[t];let o=t.value;for(;this.isComparePoint(o);){const t=n[n.length-1],r=e.rollOnce();o=r.value,t.modifiers.push("explode"),this.penetrate&&(t.modifiers.push("penetrate"),r.value--),n.push(r)}return this.compound&&n.length>1?(t.value=r.sumArray(n),t.modifiers=["explode","compound"],this.penetrate&&t.modifiers.push("penetrate"),t):n}).flat(),t}toJSON(){const{compound:t,penetrate:e}=this;return Object.assign(super.toJSON(),{compound:t,penetrate:e})}}})(),c=(()=>{const t=Symbol("rolls");return class{constructor(t){this.rolls=t||[]}get length(){return this.rolls.length||0}get rolls(){return[...this[t]||[]]}set rolls(e){if(!e||!Array.isArray(e))throw new Error("Rolls must be an array: "+e);this[t]=[],e.forEach(t=>{this.addRoll(t)})}get value(){return this.rolls.reduce((t,e)=>t+(e.useInTotal?e.calculationValue:0),0)}addRoll(e){const r=e instanceof s?e:new s(e);this[t].push(r)}toJSON(){const{rolls:t,value:e}=this;return{rolls:t,value:e}}toString(){return`[${this.rolls.join(", ")}]`}}})(),p=(()=>{const t=Symbol("once");return class extends a{constructor(t,e=!1,r=null){super(t,r),this.once=!!e,this.order=2}get once(){return!!this[t]}set once(e){this[t]=!!e}run(t,e){if(e.min===e.max)throw new Error("Die must have more than 1 side to re-roll: "+e);return t.rolls.map(t=>{let r=!1;for(;this.isComparePoint(t.value)&&(!this.once||!r);){const n=e.rollOnce();t.value=n.value,r=!0}return r&&t.modifiers.push("re-roll"+(this.once?"-once":"")),t}),t}toJSON(){const{once:t}=this;return Object.assign(super.toJSON(),{once:t})}}})(),f=(()=>{const t=Symbol("modifiers"),e=Symbol("notation"),n=Symbol("qty"),a=Symbol("sides");return class{constructor(s,c,f=1,h=null){if(!s)throw new TypeError("Dice: Notation is required");if(!c)throw new TypeError("Dice: sides is required");if(!r.isNumeric(f)||f<1)throw new TypeError("qty must be a positive integer");if(this[e]=s,this[n]=parseInt(f,10),this[a]=c,h){if(h instanceof Map)this[t]=h;else if(Array.isArray(h))this[t]=new Map(h.map(t=>[t.name,t]));else{if("object"!=typeof h)throw new Error("modifiers should be a Map or an Object");this[t]=new Map(Object.entries(h))}if(this[t].size&&[...this[t].entries()].some(t=>!(t[1]instanceof o)))throw new Error("modifiers is invalid. List must only contain Modifier instances");this[t].forEach(t=>{t instanceof u&&!t.comparePoint?t.comparePoint=new i("=",this.max):t instanceof p&&!t.comparePoint&&(t.comparePoint=new i("=",this.min))})}}get modifiers(){return this[t]?new Map([...this[t]].sort((t,e)=>t[1].order-e[1].order)):null}get max(){return this.sides}get min(){return 1}get name(){return this.constructor.name}get notation(){return this[e]}get qty(){return this[n]}get sides(){return this[a]}roll(){const t=new c;for(let e=0;e<this.qty;e++)t.addRoll(this.rollOnce());return(this.modifiers||[]).forEach(e=>{e.run(t,this)}),t}rollOnce(){return new s(r.generateNumber(this.min,this.max))}toJSON(){const{max:t,min:e,modifiers:r,name:n,notation:o,qty:i,sides:a}=this;return{max:t,min:e,modifiers:r,name:n,notation:o,qty:i,sides:a,type:"die"}}toString(){return this.notation}}})(),h=class extends f{constructor(t,e=2,r=1,n=null){if(e||0===e){if(1!==e&&2!==e)throw new Error("nonBlanks must be 1 or 2")}else e=2;super(t,parseInt(e,10),r,n)}get max(){return 1}get min(){return-1}get nonBlanks(){return super.sides}get sides(){return"F."+this.nonBlanks}rollOnce(){let t=0;if(2===this.nonBlanks)t=r.generateNumber(1,3)-2;else if(1===this.nonBlanks){const e=r.generateNumber(1,6);1===e?t=-1:6===e&&(t=1)}return new s(t)}},l=class extends f{constructor(t,e=1,r=null){super(t,100,e,r)}get max(){return 100}get sides(){return"%"}};var m=Object.freeze({__proto__:null,FudgeDice:h,PercentileDice:l,StandardDice:f});const d=class extends a{constructor(t,e){super(t,e),this.order=7}run(t,e){return t.rolls.map(t=>(this.isComparePoint(t.value)&&t.modifiers.push("critical-failure"),t)),t}},y=class extends a{constructor(t,e){super(t,e),this.order=6}run(t,e){return t.rolls.map(t=>(this.isComparePoint(t.value)&&t.modifiers.push("critical-success"),t)),t}},g=(()=>{const t=Symbol("end"),e=Symbol("qty");return class extends o{constructor(t,e,r){super(t),this.end=e,this.qty=r||0===r?r:1,this.order=3}get end(){return this[t]}set end(e){if("h"!==e&&"l"!==e)throw new Error('End must be "h" or "l"');this[t]=e}get qty(){return this[e]}set qty(t){if(!r.isNumeric(t)||t<1)throw new Error("qty must be a positive integer");this[e]=parseInt(t,10)}_rangeToDrop(t){return[this.qty,t.length]}run(t,e){return[...t.rolls].map((t,e)=>({value:t.value,index:e})).sort((t,e)=>"h"===this.end?e.value-t.value:t.value-e.value).map(t=>t.index).slice(...this._rangeToDrop(t)).forEach(e=>{const r=t.rolls[e];r.modifiers.push("drop"),r.useInTotal=!1}),t}toJSON(){const{end:t,qty:e}=this;return Object.assign(super.toJSON(),{end:t,qty:e})}}})(),v=class extends g{constructor(t,e,r){super(t,e,r),this.order=4}_rangeToDrop(t){return[0,this.qty]}},w=(()=>{const t=Symbol("direction");return class extends o{constructor(t,e="a"){super(t),this.direction=e||"a",this.order=8}get direction(){return this[t]}set direction(e){if("a"!==e&&"d"!==e)throw new Error('Direction must be "a" (Ascending) or "d" (Descending)');this[t]=e}run(t,e){return t.rolls=t.rolls.sort((t,e)=>"d"===this.direction?e.value-t.value:t.value-e.value),t}toJSON(){const{direction:t}=this;return Object.assign(super.toJSON(),{direction:t})}}})(),b=(()=>{const t=Symbol("failure-cp");return class extends a{constructor(t,e,r){super(t,e),this.failureComparePoint=r,this.order=5}get failureComparePoint(){return this[t]}set failureComparePoint(e){if(e&&!(e instanceof i))throw TypeError("failure comparePoint must be instance of ComparePoint or null");this[t]=e||null}get successComparePoint(){return this.comparePoint}set successComparePoint(t){super.comparePoint=t}getStateValue(t){return this.isSuccess(t)?1:this.isFailure(t)?-1:0}isFailure(t){return!!this.failureComparePoint&&this.failureComparePoint.isMatch(t)}isNeutral(t){return!this.isSuccess(t)&&!this.isFailure(t)}isSuccess(t){return this.isComparePoint(t)}run(t,e){return t.rolls.map(t=>(this.isSuccess(t.value)?t.modifiers.push("target-success"):this.isFailure(t)&&t.modifiers.push("target-failure"),t.calculationValue=this.getStateValue(t.value),t)),t}toJSON(){const{failureComparePoint:t,successComparePoint:e}=this,r=super.toJSON();return delete r.comparePoint,Object.assign(r,{failureComparePoint:t,successComparePoint:e})}}})();var x=Object.freeze({__proto__:null,ComparisonModifier:a,CriticalFailureModifier:d,CriticalSuccessModifier:y,DropModifier:v,ExplodeModifier:u,KeepModifier:g,ReRollModifier:p,SortingModifier:w,TargetModifier:b});const N=(()=>{const t=Symbol("modifiers"),e=Symbol("notation"),r=Symbol("expressions");return class{constructor(n,o,i=null){this[e]=n,this[r]=o,this[t]=i}get modifiers(){return this[t]}get notation(){return this[e]}get expressions(){return this[r]}toJSON(){const{modifiers:t,notation:e,expressions:r}=this;return{expressions:r,modifiers:t,notation:e,type:"group"}}}})();Number.isFinite=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},Number.isNaN=Number.isNaN||function(t){return t!=t};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function E(t,e){return t(e={exports:{}},e.exports),e.exports}var S=function(t){return t&&t.constructor.prototype.isBigNumber||!1},O=E((function(t,e){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}e.clone=function t(n){var o=r(n);if("number"===o||"string"===o||"boolean"===o||null==n)return n;if("function"==typeof n.clone)return n.clone();if(Array.isArray(n))return n.map((function(e){return t(e)}));if(n instanceof Date)return new Date(n.valueOf());if(S(n))return n;if(n instanceof RegExp)throw new TypeError("Cannot clone "+n);return e.map(n,t)},e.map=function(t,r){var n={};for(var o in t)e.hasOwnProperty(t,o)&&(n[o]=r(t[o]));return n},e.extend=function(t,r){for(var n in r)e.hasOwnProperty(r,n)&&(t[n]=r[n]);return t},e.deepExtend=function t(r,n){if(Array.isArray(n))throw new TypeError("Arrays are not supported by deepExtend");for(var o in n)if(e.hasOwnProperty(n,o))if(n[o]&&n[o].constructor===Object)void 0===r[o]&&(r[o]={}),r[o].constructor===Object?t(r[o],n[o]):r[o]=n[o];else{if(Array.isArray(n[o]))throw new TypeError("Arrays are not supported by deepExtend");r[o]=n[o]}return r},e.deepEqual=function(t,r){var n,o,i;if(Array.isArray(t)){if(!Array.isArray(r))return!1;if(t.length!==r.length)return!1;for(o=0,i=t.length;o<i;o++)if(!e.deepEqual(t[o],r[o]))return!1;return!0}if(t instanceof Object){if(Array.isArray(r)||!(r instanceof Object))return!1;for(n in t)if(!e.deepEqual(t[n],r[n]))return!1;for(n in r)if(!e.deepEqual(t[n],r[n]))return!1;return!0}return t===r},e.canDefineProperty=function(){try{if(Object.defineProperty)return Object.defineProperty({},"x",{get:function(){}}),!0}catch(t){}return!1},e.lazy=function(t,r,n){if(e.canDefineProperty()){var o,i=!0;Object.defineProperty(t,r,{get:function(){return i&&(o=n(),i=!1),o},set:function(t){o=t,i=!1},configurable:!0,enumerable:!0})}else t[r]=n()},e.traverse=function(t,e){var r=t;if(e)for(var n=e.split("."),o=0;o<n.length;o++){var i=n[o];i in r||(r[i]={}),r=r[i]}return r},e.hasOwnProperty=function(t,e){return t&&Object.hasOwnProperty.call(t,e)},e.isFactory=function(t){return t&&"function"==typeof t.factory}})),A=(O.clone,O.map,O.extend,O.deepExtend,O.deepEqual,O.canDefineProperty,O.lazy,O.traverse,O.isFactory,E((function(t,e){t.exports=function(){function t(){return!0}function e(){return!1}function r(){}return function n(){var o=[{name:"number",test:function(t){return"number"==typeof t}},{name:"string",test:function(t){return"string"==typeof t}},{name:"boolean",test:function(t){return"boolean"==typeof t}},{name:"Function",test:function(t){return"function"==typeof t}},{name:"Array",test:Array.isArray},{name:"Date",test:function(t){return t instanceof Date}},{name:"RegExp",test:function(t){return t instanceof RegExp}},{name:"Object",test:function(t){return"object"==typeof t&&t.constructor===Object}},{name:"null",test:function(t){return null===t}},{name:"undefined",test:function(t){return void 0===t}}],i={name:"any",test:t},a=[],s=[],u={types:o,conversions:s,ignore:a};function c(t){var e=q(u.types,(function(e){return e.name===t}));if(e)return e;if("any"===t)return i;var r=q(u.types,(function(e){return e.name.toLowerCase()===t.toLowerCase()}));throw new TypeError('Unknown type "'+t+'"'+(r?'. Did you mean "'+r.name+'"?':""))}function p(t){return t===i?999:u.types.indexOf(t)}function f(t){var e=q(u.types,(function(e){return e.test(t)}));if(e)return e.name;throw new TypeError("Value has unknown type. Value: "+t)}function h(t){return t.map((function(t){var e=t.types.map(b);return(t.restParam?"...":"")+e.join("|")})).join(",")}function l(t,e){var r=0===t.indexOf("..."),n=(r?t.length>3?t.slice(3):"any":t).split("|").map(M).filter(F).filter(C),o=function(t,e){var r={};return t.forEach((function(t){-1!==e.indexOf(t.from)||-1===e.indexOf(t.to)||r[t.from]||(r[t.from]=t)})),Object.keys(r).map((function(t){return r[t]}))}(e,n),i=n.map((function(t){var e=c(t);return{name:t,typeIndex:p(e),test:e.test,conversion:null,conversionIndex:-1}})),a=o.map((function(t){var r=c(t.from);return{name:t.from,typeIndex:p(r),test:r.test,conversion:t,conversionIndex:e.indexOf(t)}}));return{types:i.concat(a),restParam:r}}function m(t){var e=D(t);return!!e&&e.restParam}function d(t){return t.types.some((function(t){return null!=t.conversion}))}function y(e){if(e&&0!==e.types.length){if(1===e.types.length)return c(e.types[0].name).test;if(2===e.types.length){var r=c(e.types[0].name).test,n=c(e.types[1].name).test;return function(t){return r(t)||n(t)}}var o=e.types.map((function(t){return c(t.name).test}));return function(t){for(var e=0;e<o.length;e++)if(o[e](t))return!0;return!1}}return t}function g(t){var e,r,n,o;if(m(t)){var i=(e=(o=t,o.slice(0,o.length-1)).map(y)).length,a=y(D(t));return function(t){for(var r=0;r<e.length;r++)if(!e[r](t[r]))return!1;return function(t){for(var e=i;e<t.length;e++)if(!a(t[e]))return!1;return!0}(t)&&t.length>=i+1}}return 0===t.length?function(t){return 0===t.length}:1===t.length?(r=y(t[0]),function(t){return r(t[0])&&1===t.length}):2===t.length?(r=y(t[0]),n=y(t[1]),function(t){return r(t[0])&&n(t[1])&&2===t.length}):(e=t.map(y),function(t){for(var r=0;r<e.length;r++)if(!e[r](t[r]))return!1;return t.length===e.length})}function v(t,e){return e<t.params.length?t.params[e]:m(t.params)?D(t.params):null}function w(t,e,r){var n=v(t,e);return(n?r?n.types.filter(x):n.types:[]).map(b)}function b(t){return t.name}function x(t){return null===t.conversion||void 0===t.conversion}function N(t,e){var r=function(t){for(var e={},r=0;r<t.length;r++)e[t[r]]=!0;return Object.keys(e)}(B(t,(function(t){return w(t,e,!1)})));return-1!==r.indexOf("any")?["any"]:r}function E(t,e,r){var n,o,i,a=t||"unnamed",s=r;for(i=0;i<e.length;i++){var u=s.filter((function(t){var r=y(v(t,i));return(i<t.params.length||m(t.params))&&r(e[i])}));if(0===u.length){if((o=N(s,i)).length>0){var c=f(e[i]);return(n=new TypeError("Unexpected type of argument in function "+a+" (expected: "+o.join(" or ")+", actual: "+c+", index: "+i+")")).data={category:"wrongType",fn:a,index:i,actual:c,expected:o},n}}else s=u}var p=s.map((function(t){return m(t.params)?Infinity:t.params.length}));if(e.length<Math.min.apply(null,p))return o=N(s,i),(n=new TypeError("Too few arguments in function "+a+" (expected: "+o.join(" or ")+", index: "+e.length+")")).data={category:"tooFewArgs",fn:a,index:e.length,expected:o},n;var h=Math.max.apply(null,p);return e.length>h?((n=new TypeError("Too many arguments in function "+a+" (expected: "+h+", actual: "+e.length+")")).data={category:"tooManyArgs",fn:a,index:e.length,expectedLength:h},n):((n=new TypeError('Arguments of type "'+e.join(", ")+'" do not match any of the defined signatures of function '+a+".")).data={category:"mismatch",actual:e.map(f)},n)}function S(t){for(var e=999,r=0;r<t.types.length;r++)x(t.types[r])&&(e=Math.min(e,t.types[r].typeIndex));return e}function O(t){for(var e=999,r=0;r<t.types.length;r++)x(t.types[r])||(e=Math.min(e,t.types[r].conversionIndex));return e}function A(t,e){var r;return 0!=(r=t.restParam-e.restParam)||0!=(r=d(t)-d(e))||0!=(r=S(t)-S(e))?r:O(t)-O(e)}function j(t,e){var r,n,o=Math.min(t.params.length,e.params.length);if(0!=(n=t.params.some(d)-e.params.some(d)))return n;for(r=0;r<o;r++)if(0!=(n=d(t.params[r])-d(e.params[r])))return n;for(r=0;r<o;r++)if(0!==(n=A(t.params[r],e.params[r])))return n;return t.params.length-e.params.length}function T(t){var e,r,n,o,i=[],a=[];switch(t.types.forEach((function(t){t.conversion&&(i.push(c(t.conversion.from).test),a.push(t.conversion.convert))})),a.length){case 0:return function(t){return t};case 1:return e=i[0],n=a[0],function(t){return e(t)?n(t):t};case 2:return e=i[0],r=i[1],n=a[0],o=a[1],function(t){return e(t)?n(t):r(t)?o(t):t};default:return function(t){for(var e=0;e<a.length;e++)if(i[e](t))return a[e](t);return t}}}function k(t,e){return function t(r,n,o){if(n<r.length){var i,a=r[n],s=e?a.types.filter(x):a.types;if(a.restParam){var u=s.filter(x);i=u.length<s.length?[u,s]:[s]}else i=s.map((function(t){return[t]}));return B(i,(function(e){return t(r,n+1,o.concat([e]))}))}return[o.map((function(t,e){return{types:t,restParam:e===r.length-1&&m(r)}}))]}(t,0,[])}function P(t,n){if(0===Object.keys(n).length)throw new SyntaxError("No signatures provided");var o=[];Object.keys(n).map((function(t){return function(t,e,r){var n=[];return""!==t.trim()&&(n=t.split(",").map(M).map((function(t,e,n){var o=l(t,r);if(o.restParam&&e!==n.length-1)throw new SyntaxError('Unexpected rest parameter "'+t+'": only allowed for the last parameter');return o}))),n.some(I)?null:{params:n,fn:e}}(t,n[t],u.conversions)})).filter(_).forEach((function(t){var e=q(o,(function(e){return function(t,e){for(var r=Math.max(t.params.length,e.params.length),n=0;n<r;n++)if(!R(w(t,n,!0),w(e,n,!0)))return!1;var o=t.params.length,i=e.params.length,a=m(t.params),s=m(e.params);return a?s?o===i:i>=o:s?o>=i:o===i}(e,t)}));if(e)throw new TypeError('Conflicting signatures "'+h(e.params)+'" and "'+h(t.params)+'".');o.push(t)}));var i=B(o,(function(t){return(t?k(t.params,!1):[]).map((function(e){return{params:e,fn:t.fn}}))})).filter(_);i.sort(j);var a=i[0]&&i[0].params.length<=2&&!m(i[0].params),s=i[1]&&i[1].params.length<=2&&!m(i[1].params),c=i[2]&&i[2].params.length<=2&&!m(i[2].params),p=i[3]&&i[3].params.length<=2&&!m(i[3].params),f=i[4]&&i[4].params.length<=2&&!m(i[4].params),v=i[5]&&i[5].params.length<=2&&!m(i[5].params),b=a&&s&&c&&p&&f&&v,x=i.map((function(t){return g(t.params)})),N=a?y(i[0].params[0]):e,S=s?y(i[1].params[0]):e,O=c?y(i[2].params[0]):e,A=p?y(i[3].params[0]):e,P=f?y(i[4].params[0]):e,C=v?y(i[5].params[0]):e,F=a?y(i[0].params[1]):e,D=s?y(i[1].params[1]):e,J=c?y(i[2].params[1]):e,H=p?y(i[3].params[1]):e,W=f?y(i[4].params[1]):e,z=v?y(i[5].params[1]):e,U=i.map((function(t){return function(t,e){var r=e;if(t.some(d)){var n=m(t),o=t.map(T);r=function(){for(var t=[],r=n?arguments.length-1:arguments.length,i=0;i<r;i++)t[i]=o[i](arguments[i]);return n&&(t[r]=arguments[r].map(o[r])),e.apply(null,t)}}var i=r;if(m(t)){var a=t.length-1;i=function(){return r.apply(null,L(arguments,0,a).concat([L(arguments,a)]))}}return i}(t.params,t.fn)})),$=a?U[0]:r,V=s?U[1]:r,X=c?U[2]:r,Z=p?U[3]:r,G=f?U[4]:r,K=v?U[5]:r,Q=a?i[0].params.length:-1,Y=s?i[1].params.length:-1,tt=c?i[2].params.length:-1,et=p?i[3].params.length:-1,rt=f?i[4].params.length:-1,nt=v?i[5].params.length:-1,ot=b?6:0,it=i.length,at=function(){for(var e=ot;e<it;e++)if(x[e](arguments))return U[e].apply(null,arguments);throw E(t,arguments,i)},st=function(t,e){return arguments.length===Q&&N(t)&&F(e)?$.apply(null,arguments):arguments.length===Y&&S(t)&&D(e)?V.apply(null,arguments):arguments.length===tt&&O(t)&&J(e)?X.apply(null,arguments):arguments.length===et&&A(t)&&H(e)?Z.apply(null,arguments):arguments.length===rt&&P(t)&&W(e)?G.apply(null,arguments):arguments.length===nt&&C(t)&&z(e)?K.apply(null,arguments):at.apply(null,arguments)};try{Object.defineProperty(st,"name",{value:t})}catch(t){}return st.signatures=function(t){var e={};return t.forEach((function(t){t.params.some(d)||k(t.params,!0).forEach((function(r){e[h(r)]=t.fn}))})),e}(i),st}function C(t){return-1===u.ignore.indexOf(t)}function M(t){return t.trim()}function F(t){return!!t}function _(t){return null!==t}function I(t){return 0===t.types.length}function D(t){return t[t.length-1]}function L(t,e,r){return Array.prototype.slice.call(t,e,r)}function J(t,e){return-1!==t.indexOf(e)}function R(t,e){for(var r=0;r<t.length;r++)if(J(e,t[r]))return!0;return!1}function q(t,e){for(var r=0;r<t.length;r++)if(e(t[r]))return t[r]}function B(t,e){return Array.prototype.concat.apply([],t.map(e))}function H(t){for(var e="",r=0;r<t.length;r++){var n=t[r];if(("object"==typeof n.signatures||"string"==typeof n.signature)&&""!==n.name)if(""===e)e=n.name;else if(e!==n.name){var o=new Error("Function names do not match (expected: "+e+", actual: "+n.name+")");throw o.data={actual:n.name,expected:e},o}}return e}function W(t){var e,r={};function n(t,n){if(r.hasOwnProperty(t)&&n!==r[t])throw(e=new Error('Signature "'+t+'" is defined twice')).data={signature:t},e}for(var o=0;o<t.length;o++){var i=t[o];if("object"==typeof i.signatures)for(var a in i.signatures)i.signatures.hasOwnProperty(a)&&(n(a,i.signatures[a]),r[a]=i.signatures[a]);else{if("string"!=typeof i.signature)throw(e=new TypeError("Function is no typed-function (index: "+o+")")).data={index:o},e;n(i.signature,i),r[i.signature]=i}}return r}return(u=P("typed",{"string, Object":P,Object:function(t){var e=[];for(var r in t)t.hasOwnProperty(r)&&e.push(t[r]);return P(H(e),t)},"...Function":function(t){return P(H(t),W(t))},"string, ...Function":function(t,e){return P(t,W(e))}})).create=n,u.types=o,u.conversions=s,u.ignore=a,u.convert=function(t,e){var r=f(t);if(e===r)return t;for(var n=0;n<u.conversions.length;n++){var o=u.conversions[n];if(o.from===r&&o.to===e)return o.convert(t)}throw new Error("Cannot convert from "+r+" to "+e)},u.find=function(t,e){if(!t.signatures)throw new TypeError("Function is no typed-function");var r;if("string"==typeof e){r=e.split(",");for(var n=0;n<r.length;n++)r[n]=r[n].trim()}else{if(!Array.isArray(e))throw new TypeError("String array or a comma separated string expected");r=e}var o=r.join(","),i=t.signatures[o];if(i)return i;throw new TypeError("Signature not found (signature: "+(t.name||"unnamed")+"("+r.join(", ")+"))")},u.addType=function(t,e){if(!t||"string"!=typeof t.name||"function"!=typeof t.test)throw new TypeError("Object with properties {name: string, test: function} expected");if(!1!==e)for(var r=0;r<u.types.length;r++)if("Object"===u.types[r].name)return void u.types.splice(r,0,t);u.types.push(t)},u.addConversion=function(t){if(!t||"string"!=typeof t.from||"string"!=typeof t.to||"function"!=typeof t.convert)throw new TypeError("Object with properties {from: string, to: string, convert: function} expected");u.conversions.push(t)},u}()}()}))),j=E((function(t,e){function r(t){for(var e=[],r=0;r<t;r++)e.push(0);return e}e.isNumber=function(t){return"number"==typeof t},e.isInteger=function(t){return"boolean"==typeof t||!!isFinite(t)&&t===Math.round(t)},e.sign=Math.sign||function(t){return t>0?1:t<0?-1:0},e.format=function(t,r){if("function"==typeof r)return r(t);if(Infinity===t)return"Infinity";if(-Infinity===t)return"-Infinity";if(isNaN(t))return"NaN";var n,o="auto";switch(r&&(r.notation&&(o=r.notation),e.isNumber(r)?n=r:e.isNumber(r.precision)&&(n=r.precision)),o){case"fixed":return e.toFixed(t,n);case"exponential":return e.toExponential(t,n);case"engineering":return e.toEngineering(t,n);case"auto":if(r&&r.exponential&&(void 0!==r.exponential.lower||void 0!==r.exponential.upper)){var i=O.map(r,(function(t){return t}));return i.exponential=void 0,void 0!==r.exponential.lower&&(i.lowerExp=Math.round(Math.log(r.exponential.lower)/Math.LN10)),void 0!==r.exponential.upper&&(i.upperExp=Math.round(Math.log(r.exponential.upper)/Math.LN10)),e.toPrecision(t,n,i)}return e.toPrecision(t,n,r&&r).replace(/((\.\d*?)(0+))($|e)/,(function(){var t=arguments[2],e=arguments[4];return"."!==t?t+e:e}));default:throw new Error('Unknown notation "'+o+'". Choose "auto", "exponential", or "fixed".')}},e.splitNumber=function(t){var e=String(t).toLowerCase().match(/^0*?(-?)(\d+\.?\d*)(e([+-]?\d+))?$/);if(!e)throw new SyntaxError("Invalid number "+t);var r=e[1],n=e[2],o=parseFloat(e[4]||"0"),i=n.indexOf(".");o+=-1!==i?i-1:n.length-1;var a=n.replace(".","").replace(/^0*/,(function(t){return o-=t.length,""})).replace(/0*$/,"").split("").map((function(t){return parseInt(t)}));return 0===a.length&&(a.push(0),o++),{sign:r,coefficients:a,exponent:o}},e.toEngineering=function(t,n){if(isNaN(t)||!isFinite(t))return String(t);var o=e.roundDigits(e.splitNumber(t),n),i=o.exponent,a=o.coefficients,s=i%3==0?i:i<0?i-3-i%3:i-i%3;if(e.isNumber(n))n>a.length&&(a=a.concat(r(n-a.length)));else{var u=i>=0?i:Math.abs(s);a.length-1<u&&(a=a.concat(r(u-(a.length-1))))}for(var c=Math.abs(i-s),p=1;--c>=0;)p++;var f=a.slice(p).join(""),h=e.isNumber(n)&&f.length||f.match(/[1-9]/)?"."+f:"",l=a.slice(0,p).join("")+h+"e"+(i>=0?"+":"")+s.toString();return o.sign+l},e.toFixed=function(t,n){if(isNaN(t)||!isFinite(t))return String(t);var o=e.splitNumber(t),i="number"==typeof n?e.roundDigits(o,o.exponent+1+n):o,a=i.coefficients,s=i.exponent+1,u=s+(n||0);return a.length<u&&(a=a.concat(r(u-a.length))),s<0&&(a=r(1-s).concat(a),s=1),s<a.length&&a.splice(s,0,0===s?"0.":"."),i.sign+a.join("")},e.toExponential=function(t,n){if(isNaN(t)||!isFinite(t))return String(t);var o=e.splitNumber(t),i=n?e.roundDigits(o,n):o,a=i.coefficients,s=i.exponent;a.length<n&&(a=a.concat(r(n-a.length)));var u=a.shift();return i.sign+u+(a.length>0?"."+a.join(""):"")+"e"+(s>=0?"+":"")+s},e.toPrecision=function(t,n,o){if(isNaN(t)||!isFinite(t))return String(t);var i=o&&void 0!==o.lowerExp?o.lowerExp:-3,a=o&&void 0!==o.upperExp?o.upperExp:5,s=e.splitNumber(t);if(s.exponent<i||s.exponent>=a)return e.toExponential(t,n);var u=n?e.roundDigits(s,n):s,c=u.coefficients,p=u.exponent;c.length<n&&(c=c.concat(r(n-c.length))),c=c.concat(r(p-c.length+1+(c.length<n?n-c.length:0)));var f=p>0?p:0;return f<(c=r(-p).concat(c)).length-1&&c.splice(f+1,0,"."),u.sign+c.join("")},e.roundDigits=function(t,e){for(var r={sign:t.sign,coefficients:t.coefficients,exponent:t.exponent},n=r.coefficients;e<=0;)n.unshift(0),r.exponent++,e++;if(n.length>e&&n.splice(e,n.length-e)[0]>=5){var o=e-1;for(n[o]++;10===n[o];)n.pop(),0===o&&(n.unshift(0),r.exponent++,o++),n[--o]++}return r},e.digits=function(t){return t.toExponential().replace(/e.*$/,"").replace(/^0\.?0*|\./,"").length},e.DBL_EPSILON=Number.EPSILON||2220446049250313e-31,e.nearlyEqual=function(t,r,n){if(null==n)return t===r;if(t===r)return!0;if(isNaN(t)||isNaN(r))return!1;if(isFinite(t)&&isFinite(r)){var o=Math.abs(t-r);return o<e.DBL_EPSILON||o<=Math.max(Math.abs(t),Math.abs(r))*n}return!1}})),T=(j.isNumber,j.isInteger,j.sign,j.format,j.splitNumber,j.toEngineering,j.toFixed,j.toExponential,j.toPrecision,j.roundDigits,j.digits,j.DBL_EPSILON,j.nearlyEqual,function(t){return t&&t.constructor.prototype.isMatrix||!1});function k(t){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var P=j.digits,C=function(){return C=A.create,A},M=function(t){t.isNumber=function(t){return"number"==typeof t},t.isComplex=function(e){return t.Complex&&e instanceof t.Complex||!1},t.isBigNumber=S,t.isFraction=function(e){return t.Fraction&&e instanceof t.Fraction||!1},t.isUnit=function(t){return t&&t.constructor.prototype.isUnit||!1},t.isString=function(t){return"string"==typeof t},t.isArray=Array.isArray,t.isMatrix=T,t.isDenseMatrix=function(t){return t&&t.isDenseMatrix&&t.constructor.prototype.isMatrix||!1},t.isSparseMatrix=function(t){return t&&t.isSparseMatrix&&t.constructor.prototype.isMatrix||!1},t.isRange=function(t){return t&&t.constructor.prototype.isRange||!1},t.isIndex=function(t){return t&&t.constructor.prototype.isIndex||!1},t.isBoolean=function(t){return"boolean"==typeof t},t.isResultSet=function(t){return t&&t.constructor.prototype.isResultSet||!1},t.isHelp=function(t){return t&&t.constructor.prototype.isHelp||!1},t.isFunction=function(t){return"function"==typeof t},t.isDate=function(t){return t instanceof Date},t.isRegExp=function(t){return t instanceof RegExp},t.isObject=function(e){return"object"===k(e)&&e.constructor===Object&&!t.isComplex(e)&&!t.isFraction(e)},t.isNull=function(t){return null===t},t.isUndefined=function(t){return void 0===t},t.isAccessorNode=function(t){return t&&t.isAccessorNode&&t.constructor.prototype.isNode||!1},t.isArrayNode=function(t){return t&&t.isArrayNode&&t.constructor.prototype.isNode||!1},t.isAssignmentNode=function(t){return t&&t.isAssignmentNode&&t.constructor.prototype.isNode||!1},t.isBlockNode=function(t){return t&&t.isBlockNode&&t.constructor.prototype.isNode||!1},t.isConditionalNode=function(t){return t&&t.isConditionalNode&&t.constructor.prototype.isNode||!1},t.isConstantNode=function(t){return t&&t.isConstantNode&&t.constructor.prototype.isNode||!1},t.isFunctionAssignmentNode=function(t){return t&&t.isFunctionAssignmentNode&&t.constructor.prototype.isNode||!1},t.isFunctionNode=function(t){return t&&t.isFunctionNode&&t.constructor.prototype.isNode||!1},t.isIndexNode=function(t){return t&&t.isIndexNode&&t.constructor.prototype.isNode||!1},t.isNode=function(t){return t&&t.isNode&&t.constructor.prototype.isNode||!1},t.isObjectNode=function(t){return t&&t.isObjectNode&&t.constructor.prototype.isNode||!1},t.isOperatorNode=function(t){return t&&t.isOperatorNode&&t.constructor.prototype.isNode||!1},t.isParenthesisNode=function(t){return t&&t.isParenthesisNode&&t.constructor.prototype.isNode||!1},t.isRangeNode=function(t){return t&&t.isRangeNode&&t.constructor.prototype.isNode||!1},t.isSymbolNode=function(t){return t&&t.isSymbolNode&&t.constructor.prototype.isNode||!1},t.isChain=function(t){return t&&t.constructor.prototype.isChain||!1};var e=C();return e.types=[{name:"number",test:t.isNumber},{name:"Complex",test:t.isComplex},{name:"BigNumber",test:t.isBigNumber},{name:"Fraction",test:t.isFraction},{name:"Unit",test:t.isUnit},{name:"string",test:t.isString},{name:"Array",test:t.isArray},{name:"Matrix",test:t.isMatrix},{name:"DenseMatrix",test:t.isDenseMatrix},{name:"SparseMatrix",test:t.isSparseMatrix},{name:"Range",test:t.isRange},{name:"Index",test:t.isIndex},{name:"boolean",test:t.isBoolean},{name:"ResultSet",test:t.isResultSet},{name:"Help",test:t.isHelp},{name:"function",test:t.isFunction},{name:"Date",test:t.isDate},{name:"RegExp",test:t.isRegExp},{name:"null",test:t.isNull},{name:"undefined",test:t.isUndefined},{name:"OperatorNode",test:t.isOperatorNode},{name:"ConstantNode",test:t.isConstantNode},{name:"SymbolNode",test:t.isSymbolNode},{name:"ParenthesisNode",test:t.isParenthesisNode},{name:"FunctionNode",test:t.isFunctionNode},{name:"FunctionAssignmentNode",test:t.isFunctionAssignmentNode},{name:"ArrayNode",test:t.isArrayNode},{name:"AssignmentNode",test:t.isAssignmentNode},{name:"BlockNode",test:t.isBlockNode},{name:"ConditionalNode",test:t.isConditionalNode},{name:"IndexNode",test:t.isIndexNode},{name:"RangeNode",test:t.isRangeNode},{name:"Node",test:t.isNode},{name:"Object",test:t.isObject}],e.conversions=[{from:"number",to:"BigNumber",convert:function(e){if(P(e)>15)throw new TypeError("Cannot implicitly convert a number with >15 significant digits to BigNumber (value: "+e+"). Use function bignumber(x) to convert to BigNumber.");return new t.BigNumber(e)}},{from:"number",to:"Complex",convert:function(e){return new t.Complex(e,0)}},{from:"number",to:"string",convert:function(t){return t+""}},{from:"BigNumber",to:"Complex",convert:function(e){return new t.Complex(e.toNumber(),0)}},{from:"Fraction",to:"BigNumber",convert:function(t){throw new TypeError("Cannot implicitly convert a Fraction to BigNumber or vice versa. Use function bignumber(x) to convert to BigNumber or fraction(x) to convert to Fraction.")}},{from:"Fraction",to:"Complex",convert:function(e){return new t.Complex(e.valueOf(),0)}},{from:"number",to:"Fraction",convert:function(e){if(new t.Fraction(e).valueOf()!==e)throw new TypeError("Cannot implicitly convert a number to a Fraction when there will be a loss of precision (value: "+e+"). Use function fraction(x) to convert to Fraction.");return new t.Fraction(e)}},{from:"string",to:"number",convert:function(t){var e=Number(t);if(isNaN(e))throw new Error('Cannot convert "'+t+'" to a number');return e}},{from:"string",to:"BigNumber",convert:function(e){try{return new t.BigNumber(e)}catch(t){throw new Error('Cannot convert "'+e+'" to BigNumber')}}},{from:"string",to:"Fraction",convert:function(e){try{return new t.Fraction(e)}catch(t){throw new Error('Cannot convert "'+e+'" to Fraction')}}},{from:"string",to:"Complex",convert:function(e){try{return new t.Complex(e)}catch(t){throw new Error('Cannot convert "'+e+'" to Complex')}}},{from:"boolean",to:"number",convert:function(t){return+t}},{from:"boolean",to:"BigNumber",convert:function(e){return new t.BigNumber(+e)}},{from:"boolean",to:"Fraction",convert:function(e){return new t.Fraction(+e)}},{from:"boolean",to:"string",convert:function(t){return+t}},{from:"Array",to:"Matrix",convert:function(e){return new t.DenseMatrix(e)}},{from:"Matrix",to:"Array",convert:function(t){return t.valueOf()}}],e};function F(){}F.prototype={on:function(t,e,r){var n=this.e||(this.e={});return(n[t]||(n[t]=[])).push({fn:e,ctx:r}),this},once:function(t,e,r){var n=this;function o(){n.off(t,o),e.apply(r,arguments)}return o._=e,this.on(t,o,r)},emit:function(t){for(var e=[].slice.call(arguments,1),r=((this.e||(this.e={}))[t]||[]).slice(),n=0,o=r.length;n<o;n++)r[n].fn.apply(r[n].ctx,e);return this},off:function(t,e){var r=this.e||(this.e={}),n=r[t],o=[];if(n&&e)for(var i=0,a=n.length;i<a;i++)n[i].fn!==e&&n[i].fn._!==e&&o.push(n[i]);return o.length?r[t]=o:delete r[t],this}};var _=F,I=F;_.TinyEmitter=I;var D=function(t){var e=new _;return t.on=e.on.bind(e),t.off=e.off.bind(e),t.once=e.once.bind(e),t.emit=e.emit.bind(e),t};function L(t,e,r,n){if(!(this instanceof L))throw new SyntaxError("Constructor must be called with the new operator");this.fn=t,this.count=e,this.min=r,this.max=n,this.message="Wrong number of arguments in function "+t+" ("+e+" provided, "+r+(null!=n?"-"+n:"")+" expected)",this.stack=(new Error).stack}L.prototype=new Error,L.prototype.constructor=Error,L.prototype.name="ArgumentsError",L.prototype.isArgumentsError=!0;var J=L;function R(t){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var q=O.lazy,B=O.isFactory,H=O.traverse;var W={math:!0,name:"import",factory:function(t,e,r,n,o){function i(t,e,r){if(r.wrap&&"function"==typeof e&&(e=function(t){var e=function(){for(var e=[],r=0,n=arguments.length;r<n;r++){var i=arguments[r];e[r]=i&&i.valueOf()}return t.apply(o,e)};t.transform&&(e.transform=t.transform);return e}(e)),p(o[t])&&p(e))return e=r.override?n(t,e.signatures):n(o[t],e),o[t]=e,a(t,e),void o.emit("import",t,(function(){return e}));if(void 0===o[t]||r.override)return o[t]=e,a(t,e),void o.emit("import",t,(function(){return e}));if(!r.silent)throw new Error('Cannot import "'+t+'": already exists')}function a(t,e){e&&"function"==typeof e.transform?(o.expression.transform[t]=e.transform,f(t)&&(o.expression.mathWithTransform[t]=e.transform)):(delete o.expression.transform[t],f(t)&&(o.expression.mathWithTransform[t]=e))}function s(t){delete o.expression.transform[t],f(t)?o.expression.mathWithTransform[t]=o[t]:delete o.expression.mathWithTransform[t]}function u(t,e){if("string"==typeof t.name){var i=t.name,a=i in o.expression.transform,u=t.path?H(o,t.path):o,c=u.hasOwnProperty(i)?u[i]:void 0,f=function(){var o=r(t);if(o&&"function"==typeof o.transform)throw new Error('Transforms cannot be attached to factory functions. Please create a separate function for it with exports.path="expression.transform"');if(p(c)&&p(o))return e.override||(o=n(c,o)),o;if(void 0===c||e.override)return o;if(!e.silent)throw new Error('Cannot import "'+i+'": already exists')};!1!==t.lazy?(q(u,i,f),a?s(i):("expression.transform"===t.path||h(t))&&q(o.expression.mathWithTransform,i,f)):(u[i]=f(),a?s(i):("expression.transform"===t.path||h(t))&&(o.expression.mathWithTransform[i]=f())),o.emit("import",i,f,t.path)}else r(t)}function c(e){return"function"==typeof e||"number"==typeof e||"string"==typeof e||"boolean"==typeof e||null===e||e&&t.isUnit(e)||e&&t.isComplex(e)||e&&t.isBigNumber(e)||e&&t.isFraction(e)||e&&t.isMatrix(e)||e&&Array.isArray(e)}function p(t){return"function"==typeof t&&"object"===R(t.signatures)}function f(t){return!l.hasOwnProperty(t)}function h(t){return void 0===t.path&&!l.hasOwnProperty(t.name)}var l={expression:!0,type:!0,docs:!0,error:!0,json:!0,chain:!0};return function t(e,r){var n=arguments.length;if(1!==n&&2!==n)throw new J("import",n,1,2);if(r||(r={}),B(e))u(e,r);else if(Array.isArray(e))e.forEach((function(e){t(e,r)}));else if("object"===R(e)){for(var o in e)if(e.hasOwnProperty(o)){var a=e[o];c(a)?i(o,a,r):B(e)?u(e,r):t(a,r)}}else if(!r.silent)throw new TypeError("Factory, Object, or Array expected")}},lazy:!0};function z(t,e,r){if(void 0!==t[e]&&!function(t,e){return-1!==t.indexOf(e)}(r,t[e])){var n=function(t,e){return t.map((function(t){return t.toLowerCase()})).indexOf(e.toLowerCase())}(r,t[e]);-1!==n&&(t[e]=r[n])}}var U={name:"config",math:!0,factory:function(t,e,r,n,o){var i=["Matrix","Array"],a=["number","BigNumber","Fraction"];function s(t){if(t){var r=O.map(e,O.clone);z(t,"matrix",i),z(t,"number",a),O.deepExtend(e,t);var n=O.map(e,O.clone),s=O.map(t,O.clone);return o.emit("config",n,r,s),n}return O.map(e,O.clone)}return s.MATRIX=i,s.NUMBER=a,s}},$=O.isFactory,V={create:function(t){if("function"!=typeof Object.create)throw new Error("ES5 not supported by this JavaScript engine. Please load the es5-shim and es5-sham library for compatibility.");var e=[],r=[],n=D({});n.type={},n.expression={transform:{},mathWithTransform:{}},n.typed=M(n.type);var o={epsilon:1e-12,matrix:"Matrix",number:"number",precision:64,predictable:!1,randomSeed:null};function i(t){if(!$(t))throw new Error("Factory object with properties `type`, `name`, and `factory` expected");var a,s=e.indexOf(t);return-1===s?(a=!0===t.math?t.factory(n.type,o,i,n.typed,n):t.factory(n.type,o,i,n.typed),e.push(t),r.push(a)):a=r[s],a}return n.import=i(W),n.config=i(U),n.expression.mathWithTransform.config=n.config,t&&n.config(t),n}},X=function t(e,r,n){return e&&"function"==typeof e.map?e.map((function(e){return t(e,r)})):r(e)};function Z(t){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var G={name:"typeof",factory:function(t,e,r,n){var o=n("_typeof",{any:function(e){var r=Z(e);return"object"===r?null===e?"null":Array.isArray(e)?"Array":e instanceof Date?"Date":e instanceof RegExp?"RegExp":t.isBigNumber(e)?"BigNumber":t.isComplex(e)?"Complex":t.isFraction(e)?"Fraction":t.isMatrix(e)?"Matrix":t.isUnit(e)?"Unit":t.isIndex(e)?"Index":t.isRange(e)?"Range":t.isResultSet(e)?"ResultSet":t.isNode(e)?e.type:t.isChain(e)?"Chain":t.isHelp(e)?"Help":"Object":"function"===r?"Function":r}});return o.toTex=void 0,o}};var K={name:"number",factory:function(t,e,r,n){var o=n("number",{"":function(){return 0},number:function(t){return t},string:function(t){if("NaN"===t)return NaN;var e=Number(t);if(isNaN(e))throw new SyntaxError('String "'+t+'" is no valid number');return e},BigNumber:function(t){return t.toNumber()},Fraction:function(t){return t.valueOf()},Unit:function(t){throw new Error("Second argument with valueless unit expected")},null:function(t){return 0},"Unit, string | Unit":function(t,e){return t.toNumber(e)},"Array | Matrix":function(t){return X(t,o)}});return o.toTex={0:"0",1:"\\left(${args[0]}\\right)",2:"\\left(\\left(${args[0]}\\right)${args[1]}\\right)"},o}};var Q={name:"bignumber",factory:function(t,e,r,n){var o=n("bignumber",{"":function(){return new t.BigNumber(0)},number:function(e){return new t.BigNumber(e+"")},string:function(e){return new t.BigNumber(e)},BigNumber:function(t){return t},Fraction:function(e){return new t.BigNumber(e.n).div(e.d).times(e.s)},null:function(e){return new t.BigNumber(0)},"Array | Matrix":function(t){return X(t,o)}});return o.toTex={0:"0",1:"\\left(${args[0]}\\right)"},o}};var Y={name:"fraction",factory:function(t,e,r,n){var o=n("fraction",{number:function(e){if(!isFinite(e)||isNaN(e))throw new Error(e+" cannot be represented as a fraction");return new t.Fraction(e)},string:function(e){return new t.Fraction(e)},"number, number":function(e,r){return new t.Fraction(e,r)},null:function(e){return new t.Fraction(0)},BigNumber:function(e){return new t.Fraction(e.toString())},Fraction:function(t){return t},Object:function(e){return new t.Fraction(e)},"Array | Matrix":function(t){return X(t,o)}});return o}};var tt={path:"type",name:"_numeric",factory:function(t,e,r,n){var o=r(G),i={string:!0,number:!0,BigNumber:!0,Fraction:!0},a={number:r(K),BigNumber:r(Q),Fraction:r(Y)},s=function(t,e){var r=o(t);if(!(r in i))throw new TypeError("Cannot convert "+t+' of type "'+r+'"; valid input types are '+Object.keys(i).join(", "));if(!(e in a))throw new TypeError("Cannot convert "+t+' to type "'+e+'"; valid output types are '+Object.keys(a).join(", "));return e===r?t:a[e](t)};return s.toTex=function(t,e){return t.args[0].toTex()},s}};function et(t){return(et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var rt=O.hasOwnProperty;function nt(t,e){return!(!t||"object"!==et(t))&&(!!rt(at,e)||!(e in Object.prototype)&&!(e in Function.prototype))}function ot(t,e){return!(!t||"function"!=typeof t[e])&&(!(rt(t,e)&&Object.getPrototypeOf&&e in Object.getPrototypeOf(t))&&(!!rt(st,e)||!(e in Object.prototype)&&!(e in Function.prototype)))}function it(t){return"object"===et(t)&&t&&t.constructor===Object}var at={length:!0,name:!0},st={toString:!0,valueOf:!0,toLocaleString:!0},ut={getSafeProperty:function(t,e){if(it(t)&&nt(t,e))return t[e];if("function"==typeof t[e]&&ot(t,e))throw new Error('Cannot access method "'+e+'" as a property');throw new Error('No access to property "'+e+'"')},setSafeProperty:function(t,e,r){if(it(t)&&nt(t,e))return t[e]=r,r;throw new Error('No access to property "'+e+'"')},isSafeProperty:nt,validateSafeMethod:function(t,e){if(!ot(t,e))throw new Error('No access to method "'+e+'"')},isSafeMethod:ot,isPlainObject:it},ct={end:!0};function pt(t){return(pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var ft=O.deepEqual,ht=O.hasOwnProperty;var lt={name:"Node",path:"expression.node",math:!0,factory:function(t,e,r,n,o){function i(){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator")}return i.prototype.eval=function(t){return this.compile().eval(t)},i.prototype.type="Node",i.prototype.isNode=!0,i.prototype.comment="",i.prototype.compile=function(){var t=this._compile(o.expression.mathWithTransform,{}),e={};return{eval:function(r){var n=r||{};return function(t){for(var e in t)if(ht(t,e)&&e in ct)throw new Error('Scope contains an illegal symbol, "'+e+'" is a reserved keyword')}(n),t(n,e,null)}}},i.prototype._compile=function(t,e){throw new Error("Method _compile should be implemented by type "+this.type)},i.prototype.forEach=function(t){throw new Error("Cannot run forEach on a Node interface")},i.prototype.map=function(t){throw new Error("Cannot run map on a Node interface")},i.prototype._ifNode=function(e){if(!t.isNode(e))throw new TypeError("Callback function must return a Node");return e},i.prototype.traverse=function(t){t(this,null,null),function t(e,r){e.forEach((function(e,n,o){r(e,n,o),t(e,r)}))}(this,t)},i.prototype.transform=function(t){return function t(e,r){return e.map((function(e,n,o){return t(r(e,n,o),r)}))}(t(this,null,null),t)},i.prototype.filter=function(t){var e=[];return this.traverse((function(r,n,o){t(r,n,o)&&e.push(r)})),e},i.prototype.find=function(){throw new Error("Function Node.find is deprecated. Use Node.filter instead.")},i.prototype.match=function(){throw new Error("Function Node.match is deprecated. See functions Node.filter, Node.transform, Node.traverse.")},i.prototype.clone=function(){throw new Error("Cannot clone a Node interface")},i.prototype.cloneDeep=function(){return this.map((function(t){return t.cloneDeep()}))},i.prototype.equals=function(t){return!!t&&ft(this,t)},i.prototype.toString=function(t){var e;if(t&&"object"===pt(t))switch(pt(t.handler)){case"object":case"undefined":break;case"function":e=t.handler(this,t);break;default:throw new TypeError("Object or function expected as callback")}return void 0!==e?e:this._toString(t)},i.prototype.toJSON=function(){throw new Error("Cannot serialize object: toJSON not implemented by "+this.type)},i.prototype.toHTML=function(t){var e;if(t&&"object"===pt(t))switch(pt(t.handler)){case"object":case"undefined":break;case"function":e=t.handler(this,t);break;default:throw new TypeError("Object or function expected as callback")}return void 0!==e?e:this.toHTML(t)},i.prototype._toString=function(){throw new Error("_toString not implemented for "+this.type)},i.prototype.toTex=function(t){var e;if(t&&"object"===pt(t))switch(pt(t.handler)){case"object":case"undefined":break;case"function":e=t.handler(this,t);break;default:throw new TypeError("Object or function expected as callback")}return void 0!==e?e:this._toTex(t)},i.prototype._toTex=function(t){throw new Error("_toTex not implemented for "+this.type)},i.prototype.getIdentifier=function(){return this.type},i.prototype.getContent=function(){return this},i}};function mt(t,e,r){if(!(this instanceof mt))throw new SyntaxError("Constructor must be called with the new operator");this.index=t,arguments.length<3?(this.min=0,this.max=e):(this.min=e,this.max=r),void 0!==this.min&&this.index<this.min?this.message="Index out of range ("+this.index+" < "+this.min+")":void 0!==this.max&&this.index>=this.max?this.message="Index out of range ("+this.index+" > "+(this.max-1)+")":this.message="Index out of range ("+this.index+")",this.stack=(new Error).stack}mt.prototype=new RangeError,mt.prototype.constructor=RangeError,mt.prototype.name="IndexError",mt.prototype.isIndexError=!0;var dt=mt,yt=function(t){return t&&t.isIndexError?new dt(t.index+1,t.min+1,void 0!==t.max?t.max+1:void 0):t},gt=E((function(t,e){e.format=function(t,r){if("function"==typeof r)return r(t);if(!t.isFinite())return t.isNaN()?"NaN":t.gt(0)?"Infinity":"-Infinity";var n,o="auto";switch(void 0!==r&&(r.notation&&(o=r.notation),"number"==typeof r?n=r:r.precision&&(n=r.precision)),o){case"fixed":return e.toFixed(t,n);case"exponential":return e.toExponential(t,n);case"engineering":return e.toEngineering(t,n);case"auto":if(r&&r.exponential&&(void 0!==r.exponential.lower||void 0!==r.exponential.upper)){var i=O.map(r,(function(t){return t}));return i.exponential=void 0,void 0!==r.exponential.lower&&(i.lowerExp=Math.round(Math.log(r.exponential.lower)/Math.LN10)),void 0!==r.exponential.upper&&(i.upperExp=Math.round(Math.log(r.exponential.upper)/Math.LN10)),e.format(t,i)}var a=r&&void 0!==r.lowerExp?r.lowerExp:-3,s=r&&void 0!==r.upperExp?r.upperExp:5;if(t.isZero())return"0";var u=t.e;return(u>=a&&u<s?t.toSignificantDigits(n).toFixed():e.toExponential(t,n)).replace(/((\.\d*?)(0+))($|e)/,(function(){var t=arguments[2],e=arguments[4];return"."!==t?t+e:e}));default:throw new Error('Unknown notation "'+o+'". Choose "auto", "exponential", or "fixed".')}},e.toEngineering=function(t,e){var r=t.e,n=r%3==0?r:r<0?r-3-r%3:r-r%3,o=Math.abs(r-n);return t.mul(Math.pow(10,o-r)).toPrecision(e).toString()+"e"+(r>=0?"+":"")+n.toString()},e.toExponential=function(t,e){return void 0!==e?t.toExponential(e-1):t.toExponential()},e.toFixed=function(t,e){return t.toFixed(e)}})),vt=(gt.format,gt.toEngineering,gt.toExponential,gt.toFixed,E((function(t,e){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var n=j.format,o=gt.format;e.isString=function(t){return"string"==typeof t},e.endsWith=function(t,e){var r=t.length-e.length,n=t.length;return t.substring(r,n)===e},e.format=function(t,i){if("number"==typeof t)return n(t,i);if(S(t))return o(t,i);if(function(t){return t&&"object"===r(t)&&"number"==typeof t.s&&"number"==typeof t.n&&"number"==typeof t.d||!1}(t))return i&&"decimal"===i.fraction?t.toString():t.s*t.n+"/"+t.d;if(Array.isArray(t))return function t(r,n){if(Array.isArray(r)){for(var o="[",i=r.length,a=0;a<i;a++)0!==a&&(o+=", "),o+=t(r[a],n);return o+="]"}return e.format(r,n)}(t,i);if(e.isString(t))return'"'+t+'"';if("function"==typeof t)return t.syntax?String(t.syntax):"function";if(t&&"object"===r(t)){if("function"==typeof t.format)return t.format(i);if(t&&t.toString()!=={}.toString())return t.toString();var a=[];for(var s in t)t.hasOwnProperty(s)&&a.push('"'+s+'": '+e.format(t[s],i));return"{"+a.join(", ")+"}"}return String(t)},e.stringify=function(t){for(var e=String(t),r="",n=0;n<e.length;){var o=e.charAt(n);"\\"===o?(r+=o,n++,""!==(o=e.charAt(n))&&-1!=='"\\/bfnrtu'.indexOf(o)||(r+="\\"),r+=o):r+='"'===o?'\\"':o,n++}return'"'+r+'"'},e.escape=function(t){var e=String(t);return e=e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}})));vt.isString,vt.endsWith,vt.format,vt.stringify,vt.escape;function wt(t,e,r){if(!(this instanceof wt))throw new SyntaxError("Constructor must be called with the new operator");this.actual=t,this.expected=e,this.relation=r,this.message="Dimension mismatch ("+(Array.isArray(t)?"["+t.join(", ")+"]":t)+" "+(this.relation||"!=")+" "+(Array.isArray(e)?"["+e.join(", ")+"]":e)+")",this.stack=(new Error).stack}wt.prototype=new RangeError,wt.prototype.constructor=RangeError,wt.prototype.name="DimensionError",wt.prototype.isDimensionError=!0;var bt,xt=wt,Nt=E((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.size=s,e.validate=function(t,e){if(0===e.length){if(Array.isArray(t))throw new o.default(t.length,0)}else!function t(e,r,n){var i,a=e.length;if(a!==r[n])throw new o.default(a,r[n]);if(n<r.length-1){var s=n+1;for(i=0;i<a;i++){var u=e[i];if(!Array.isArray(u))throw new o.default(r.length-1,r.length,"<");t(e[i],r,s)}}else for(i=0;i<a;i++)if(Array.isArray(e[i]))throw new o.default(r.length+1,r.length,">")}(t,e,0)},e.validateIndex=function(t,e){if(!r.default.isNumber(t)||!r.default.isInteger(t))throw new TypeError("Index must be an integer (value: "+t+")");if(t<0||"number"==typeof e&&t>=e)throw new i.default(t,e)},e.resize=function(t,e,o){if(!Array.isArray(t)||!Array.isArray(e))throw new TypeError("Array expected");if(0===e.length)throw new Error("Resizing to scalar is not supported");e.forEach((function(t){if(!r.default.isNumber(t)||!r.default.isInteger(t)||t<0)throw new TypeError("Invalid size, must contain positive integers (size: "+n.default.format(e)+")")}));var i=void 0!==o?o:0;return function t(e,r,n,o){var i,a,s=e.length,u=r[n],c=Math.min(s,u);if(e.length=u,n<r.length-1){var p=n+1;for(i=0;i<c;i++)a=e[i],Array.isArray(a)||(a=[a],e[i]=a),t(a,r,p,o);for(i=c;i<u;i++)a=[],e[i]=a,t(a,r,p,o)}else{for(i=0;i<c;i++)for(;Array.isArray(e[i]);)e[i]=e[i][0];for(i=c;i<u;i++)e[i]=o}}(t,e,0,i),t},e.reshape=function(t,e){var r,n=u(t);function i(t){return t.reduce((function(t,e){return t*e}))}if(!Array.isArray(t)||!Array.isArray(e))throw new TypeError("Array expected");if(0===e.length)throw new o.default(0,i(s(t)),"!=");for(var a=1,c=0;c<e.length;c++)a*=e[c];if(n.length!==a)throw new o.default(i(e),i(s(t)),"!=");try{r=function(t,e){for(var r,n=t,o=e.length-1;o>0;o--){var i=e[o];r=[];for(var a=n.length/i,s=0;s<a;s++)r.push(n.slice(s*i,(s+1)*i));n=r}return n}(n,e)}catch(r){if(r instanceof o.default)throw new o.default(i(e),i(s(t)),"!=");throw r}return r},e.squeeze=function(t,e){var r=e||s(t);for(;Array.isArray(t)&&1===t.length;)t=t[0],r.shift();var n=r.length;for(;1===r[n-1];)n--;n<r.length&&(t=function t(e,r,n){var o,i;if(n<r){var a=n+1;for(o=0,i=e.length;o<i;o++)e[o]=t(e[o],r,a)}else for(;Array.isArray(e);)e=e[0];return e}(t,n,0),r.length=n);return t},e.unsqueeze=function(t,e,r,n){var o=n||s(t);if(r)for(var i=0;i<r;i++)t=[t],o.unshift(1);t=function t(e,r,n){var o,i;if(Array.isArray(e)){var a=n+1;for(o=0,i=e.length;o<i;o++)e[o]=t(e[o],r,a)}else for(var s=n;s<r;s++)e=[e];return e}(t,e,0);for(;o.length<e;)o.push(1);return t},e.flatten=u,e.map=function(t,e){return Array.prototype.map.call(t,e)},e.forEach=function(t,e){Array.prototype.forEach.call(t,e)},e.filter=function(t,e){if(1!==s(t).length)throw new Error("Only one dimensional matrices supported");return Array.prototype.filter.call(t,e)},e.filterRegExp=function(t,e){if(1!==s(t).length)throw new Error("Only one dimensional matrices supported");return Array.prototype.filter.call(t,(function(t){return e.test(t)}))},e.join=function(t,e){return Array.prototype.join.call(t,e)},e.identify=function(t){if(!Array.isArray(t))throw new TypeError("Array input expected");if(0===t.length)return t;var e=[],r=0;e[0]={value:t[0],identifier:0};for(var n=1;n<t.length;n++)t[n]===t[n-1]?r++:r=0,e.push({value:t[n],identifier:r});return e},e.generalize=function(t){if(!Array.isArray(t))throw new TypeError("Array input expected");if(0===t.length)return t;for(var e=[],r=0;r<t.length;r++)e.push(t[r].value);return e};var r=a(j),n=a(vt),o=a(xt),i=a(dt);function a(t){return t&&t.__esModule?t:{default:t}}function s(t){for(var e=[];Array.isArray(t);)e.push(t.length),t=t[0];return e}function u(t){if(!Array.isArray(t))return t;var e=[];return t.forEach((function t(r){Array.isArray(r)?r.forEach(t):e.push(r)})),e}}));(bt=Nt)&&bt.__esModule&&Object.prototype.hasOwnProperty.call(bt,"default")&&bt.default;Nt.size,Nt.validate,Nt.validateIndex,Nt.resize,Nt.reshape,Nt.squeeze,Nt.unsqueeze,Nt.flatten,Nt.map,Nt.forEach,Nt.filter,Nt.filterRegExp,Nt.join,Nt.identify,Nt.generalize;var Et={name:"matrix",factory:function(t,e,r,n){var o=n("matrix",{"":function(){return i([])},string:function(t){return i([],t)},"string, string":function(t,e){return i([],t,e)},Array:function(t){return i(t)},Matrix:function(t){return i(t,t.storage())},"Array | Matrix, string":i,"Array | Matrix, string, string":i});return o.toTex={0:"\\begin{bmatrix}\\end{bmatrix}",1:"\\left(${args[0]}\\right)",2:"\\left(${args[0]}\\right)"},o;function i(e,r,n){return new(t.Matrix.storage(r||"default"))(e,n)}}},St=O.clone,Ot=Nt.validateIndex,At=ut.getSafeProperty,jt=ut.setSafeProperty;function Tt(t,e){if(1!==e.size().length)throw new xt(e.size(),1);var r=e.dimension(0);if("string"!=typeof r)throw new TypeError("String expected as index to retrieve an object property");return At(t,r)}function kt(t,e,r){if(1!==e.size().length)throw new xt(e.size(),1);var n=e.dimension(0);if("string"!=typeof n)throw new TypeError("String expected as index to retrieve an object property");var o=St(t);return jt(o,n,r),o}var Pt={name:"subset",factory:function(t,e,r,n){var o=r(Et),i=n("subset",{"Array, Index":function(t,e){var r=o(t).subset(e);return e.isScalar()?r:r.valueOf()},"Matrix, Index":function(t,e){return t.subset(e)},"Object, Index":Tt,"string, Index":function(e,r){if(!t.isIndex(r))throw new TypeError("Index expected");if(1!==r.size().length)throw new xt(r.size().length,1);var n=e.length;Ot(r.min()[0],n),Ot(r.max()[0],n);var o=r.dimension(0),i="";return o.forEach((function(t){i+=e.charAt(t)})),i},"Array, Index, any":function(t,e,r){return o(St(t)).subset(e,r,void 0).valueOf()},"Array, Index, any, any":function(t,e,r,n){return o(St(t)).subset(e,r,n).valueOf()},"Matrix, Index, any":function(t,e,r){return t.clone().subset(e,r)},"Matrix, Index, any, any":function(t,e,r,n){return t.clone().subset(e,r,n)},"string, Index, string":a,"string, Index, string, string":a,"Object, Index, any":kt});return i.toTex=void 0,i;function a(t,e,r,n){if(!e||!0!==e.isIndex)throw new TypeError("Index expected");if(1!==e.size().length)throw new xt(e.size().length,1);if(void 0!==n){if("string"!=typeof n||1!==n.length)throw new TypeError("Single character expected as defaultValue")}else n=" ";var o=e.dimension(0);if(o.size()[0]!==r.length)throw new xt(o.size()[0],r.length);var i=t.length;Ot(e.min()[0]),Ot(e.max()[0]);for(var a=[],s=0;s<i;s++)a[s]=t.charAt(s);if(o.forEach((function(t,e){a[t]=r.charAt(e[0])})),a.length>i)for(var u=i-1,c=a.length;u<c;u++)a[u]||(a[u]=n);return a.join("")}}};function Ct(t){return(Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var Mt=yt,Ft=ut.getSafeProperty;var _t={factory:function(t,e,r,n){var o=r(Pt);return function(t,e){try{if(Array.isArray(t))return o(t,e);if(t&&"function"==typeof t.subset)return t.subset(e);if("string"==typeof t)return o(t,e);if("object"===Ct(t)){if(!e.isObjectProperty())throw new TypeError("Cannot apply a numeric index as object property");return Ft(t,e.getObjectProperty())}throw new TypeError("Cannot apply index: unsupported type of object")}catch(t){throw Mt(t)}}}},It=ut.getSafeProperty;var Dt={name:"AccessorNode",path:"expression.node",factory:function(t,e,r,n){var o=r(lt),i=r(_t);function a(e,r){if(!(this instanceof a))throw new SyntaxError("Constructor must be called with the new operator");if(!t.isNode(e))throw new TypeError('Node expected for parameter "object"');if(!t.isIndexNode(r))throw new TypeError('IndexNode expected for parameter "index"');this.object=e||null,this.index=r,Object.defineProperty(this,"name",{get:function(){return this.index?this.index.isObjectProperty()?this.index.getObjectProperty():"":this.object.name||""}.bind(this),set:function(){throw new Error("Cannot assign a new name, name is read-only")}})}function s(e){return!(t.isAccessorNode(e)||t.isArrayNode(e)||t.isConstantNode(e)||t.isFunctionNode(e)||t.isObjectNode(e)||t.isParenthesisNode(e)||t.isSymbolNode(e))}return a.prototype=new o,a.prototype.type="AccessorNode",a.prototype.isAccessorNode=!0,a.prototype._compile=function(t,e){var r=this.object._compile(t,e),n=this.index._compile(t,e);if(this.index.isObjectProperty()){var o=this.index.getObjectProperty();return function(t,e,n){return It(r(t,e,n),o)}}return function(t,e,o){var a=r(t,e,o),s=n(t,e,a);return i(a,s)}},a.prototype.forEach=function(t){t(this.object,"object",this),t(this.index,"index",this)},a.prototype.map=function(t){return new a(this._ifNode(t(this.object,"object",this)),this._ifNode(t(this.index,"index",this)))},a.prototype.clone=function(){return new a(this.object,this.index)},a.prototype._toString=function(t){var e=this.object.toString(t);return s(this.object)&&(e="("+e+")"),e+this.index.toString(t)},a.prototype.toHTML=function(t){var e=this.object.toHTML(t);return s(this.object)&&(e='<span class="math-parenthesis math-round-parenthesis">(</span>'+e+'<span class="math-parenthesis math-round-parenthesis">)</span>'),e+this.index.toHTML(t)},a.prototype._toTex=function(t){var e=this.object.toTex(t);return s(this.object)&&(e="\\left(' + object + '\\right)"),e+this.index.toTex(t)},a.prototype.toJSON=function(){return{mathjs:"AccessorNode",object:this.object,index:this.index}},a.fromJSON=function(t){return new a(t.object,t.index)},a}},Lt=Nt.map;var Jt={name:"ArrayNode",path:"expression.node",factory:function(t,e,r,n){var o=r(lt);function i(e){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if(this.items=e||[],!Array.isArray(this.items)||!this.items.every(t.isNode))throw new TypeError("Array containing Nodes expected");var r=function(){throw new Error("Property `ArrayNode.nodes` is deprecated, use `ArrayNode.items` instead")};Object.defineProperty(this,"nodes",{get:r,set:r})}return i.prototype=new o,i.prototype.type="ArrayNode",i.prototype.isArrayNode=!0,i.prototype._compile=function(t,e){var r=Lt(this.items,(function(r){return r._compile(t,e)}));if("Array"!==t.config().matrix){var n=t.matrix;return function(t,e,o){return n(Lt(r,(function(r){return r(t,e,o)})))}}return function(t,e,n){return Lt(r,(function(r){return r(t,e,n)}))}},i.prototype.forEach=function(t){for(var e=0;e<this.items.length;e++){t(this.items[e],"items["+e+"]",this)}},i.prototype.map=function(t){for(var e=[],r=0;r<this.items.length;r++)e[r]=this._ifNode(t(this.items[r],"items["+r+"]",this));return new i(e)},i.prototype.clone=function(){return new i(this.items.slice(0))},i.prototype._toString=function(t){return"["+this.items.map((function(e){return e.toString(t)})).join(", ")+"]"},i.prototype.toJSON=function(){return{mathjs:"ArrayNode",items:this.items}},i.fromJSON=function(t){return new i(t.items)},i.prototype.toHTML=function(t){return'<span class="math-parenthesis math-square-parenthesis">[</span>'+this.items.map((function(e){return e.toHTML(t)})).join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-square-parenthesis">]</span>'},i.prototype._toTex=function(t){var e="\\begin{bmatrix}";return this.items.forEach((function(r){r.items?e+=r.items.map((function(e){return e.toTex(t)})).join("&"):e+=r.toTex(t),e+="\\\\"})),e+="\\end{bmatrix}"},i}};function Rt(t){return(Rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var qt=yt,Bt=ut.setSafeProperty;var Ht={factory:function(t,e,r,n){var o=r(Pt),i=r(Et);return function(t,e,r){try{if(Array.isArray(t))return i(t).subset(e,r).valueOf();if(t&&"function"==typeof t.subset)return t.subset(e,r);if("string"==typeof t)return o(t,e,r);if("object"===Rt(t)){if(!e.isObjectProperty())throw TypeError("Cannot apply a numeric index as object property");return Bt(t,e.getObjectProperty(),r),t}throw new TypeError("Cannot apply index: unsupported type of object")}catch(t){throw qt(t)}}}},Wt=[{AssignmentNode:{},FunctionAssignmentNode:{}},{ConditionalNode:{latexLeftParens:!1,latexRightParens:!1,latexParens:!1}},{"OperatorNode:or":{associativity:"left",associativeWith:[]}},{"OperatorNode:xor":{associativity:"left",associativeWith:[]}},{"OperatorNode:and":{associativity:"left",associativeWith:[]}},{"OperatorNode:bitOr":{associativity:"left",associativeWith:[]}},{"OperatorNode:bitXor":{associativity:"left",associativeWith:[]}},{"OperatorNode:bitAnd":{associativity:"left",associativeWith:[]}},{"OperatorNode:equal":{associativity:"left",associativeWith:[]},"OperatorNode:unequal":{associativity:"left",associativeWith:[]},"OperatorNode:smaller":{associativity:"left",associativeWith:[]},"OperatorNode:larger":{associativity:"left",associativeWith:[]},"OperatorNode:smallerEq":{associativity:"left",associativeWith:[]},"OperatorNode:largerEq":{associativity:"left",associativeWith:[]},RelationalNode:{associativity:"left",associativeWith:[]}},{"OperatorNode:leftShift":{associativity:"left",associativeWith:[]},"OperatorNode:rightArithShift":{associativity:"left",associativeWith:[]},"OperatorNode:rightLogShift":{associativity:"left",associativeWith:[]}},{"OperatorNode:to":{associativity:"left",associativeWith:[]}},{RangeNode:{}},{"OperatorNode:add":{associativity:"left",associativeWith:["OperatorNode:add","OperatorNode:subtract"]},"OperatorNode:subtract":{associativity:"left",associativeWith:[]}},{"OperatorNode:multiply":{associativity:"left",associativeWith:["OperatorNode:multiply","OperatorNode:divide","Operator:dotMultiply","Operator:dotDivide"]},"OperatorNode:divide":{associativity:"left",associativeWith:[],latexLeftParens:!1,latexRightParens:!1,latexParens:!1},"OperatorNode:dotMultiply":{associativity:"left",associativeWith:["OperatorNode:multiply","OperatorNode:divide","OperatorNode:dotMultiply","OperatorNode:doDivide"]},"OperatorNode:dotDivide":{associativity:"left",associativeWith:[]},"OperatorNode:mod":{associativity:"left",associativeWith:[]}},{"OperatorNode:unaryPlus":{associativity:"right"},"OperatorNode:unaryMinus":{associativity:"right"},"OperatorNode:bitNot":{associativity:"right"},"OperatorNode:not":{associativity:"right"}},{"OperatorNode:pow":{associativity:"right",associativeWith:[],latexRightParens:!1},"OperatorNode:dotPow":{associativity:"right",associativeWith:[]}},{"OperatorNode:factorial":{associativity:"left"}},{"OperatorNode:transpose":{associativity:"left"}}];function zt(t,e){var r=t;"keep"!==e&&(r=t.getContent());for(var n=r.getIdentifier(),o=0;o<Wt.length;o++)if(n in Wt[o])return o;return null}var Ut={properties:Wt,getPrecedence:zt,getAssociativity:function(t,e){var r=t;"keep"!==e&&(r=t.getContent());var n=r.getIdentifier(),o=zt(r,e);if(null===o)return null;var i=Wt[o][n];if(i.hasOwnProperty("associativity")){if("left"===i.associativity)return"left";if("right"===i.associativity)return"right";throw Error("'"+n+"' has the invalid associativity '"+i.associativity+"'.")}return null},isAssociativeWith:function(t,e,r){var n="keep"!==r?t.getContent():t,o="keep"!==r?t.getContent():e,i=n.getIdentifier(),a=o.getIdentifier(),s=zt(n,r);if(null===s)return null;var u=Wt[s][i];if(u.hasOwnProperty("associativeWith")&&u.associativeWith instanceof Array){for(var c=0;c<u.associativeWith.length;c++)if(u.associativeWith[c]===a)return!0;return!1}return null}},$t=ut.getSafeProperty,Vt=ut.setSafeProperty;var Xt={name:"AssignmentNode",path:"expression.node",factory:function(t,e,r,n){var o=r(lt),i=r(Ht),a=r(_t),s=Ut;function u(e,r,n){if(!(this instanceof u))throw new SyntaxError("Constructor must be called with the new operator");if(this.object=e,this.index=n?r:null,this.value=n||r,!t.isSymbolNode(e)&&!t.isAccessorNode(e))throw new TypeError('SymbolNode or AccessorNode expected as "object"');if(t.isSymbolNode(e)&&"end"===e.name)throw new Error('Cannot assign to symbol "end"');if(this.index&&!t.isIndexNode(this.index))throw new TypeError('IndexNode expected as "index"');if(!t.isNode(this.value))throw new TypeError('Node expected as "value"');Object.defineProperty(this,"name",{get:function(){return this.index?this.index.isObjectProperty()?this.index.getObjectProperty():"":this.object.name||""}.bind(this),set:function(){throw new Error("Cannot assign a new name, name is read-only")}})}function c(t,e){e||(e="keep");var r=s.getPrecedence(t,e),n=s.getPrecedence(t.value,e);return"all"===e||null!==n&&n<=r}return u.prototype=new o,u.prototype.type="AssignmentNode",u.prototype.isAssignmentNode=!0,u.prototype._compile=function(e,r){var n=this.object._compile(e,r),o=this.index?this.index._compile(e,r):null,s=this.value._compile(e,r),u=this.object.name;if(this.index){if(this.index.isObjectProperty()){var c=this.index.getObjectProperty();return function(t,e,r){var o=n(t,e,r),i=s(t,e,r);return Vt(o,c,i)}}if(t.isSymbolNode(this.object))return function(t,e,r){var a=n(t,e,r),c=s(t,e,r),p=o(t,e,a);return Vt(t,u,i(a,p,c)),c};var p=this.object.object._compile(e,r);if(this.object.index.isObjectProperty()){var f=this.object.index.getObjectProperty();return function(t,e,r){var n=p(t,e,r),a=$t(n,f),u=o(t,e,a),c=s(t,e,r);return Vt(n,f,i(a,u,c)),c}}var h=this.object.index._compile(e,r);return function(t,e,r){var n=p(t,e,r),u=h(t,e,n),c=a(n,u),f=o(t,e,c),l=s(t,e,r);return i(n,u,i(c,f,l)),l}}if(!t.isSymbolNode(this.object))throw new TypeError("SymbolNode expected as object");return function(t,e,r){return Vt(t,u,s(t,e,r))}},u.prototype.forEach=function(t){t(this.object,"object",this),this.index&&t(this.index,"index",this),t(this.value,"value",this)},u.prototype.map=function(t){return new u(this._ifNode(t(this.object,"object",this)),this.index?this._ifNode(t(this.index,"index",this)):null,this._ifNode(t(this.value,"value",this)))},u.prototype.clone=function(){return new u(this.object,this.index,this.value)},u.prototype._toString=function(t){var e=this.object.toString(t),r=this.index?this.index.toString(t):"",n=this.value.toString(t);return c(this,t&&t.parenthesis)&&(n="("+n+")"),e+r+" = "+n},u.prototype.toJSON=function(){return{mathjs:"AssignmentNode",object:this.object,index:this.index,value:this.value}},u.fromJSON=function(t){return new u(t.object,t.index,t.value)},u.prototype.toHTML=function(t){var e=this.object.toHTML(t),r=this.index?this.index.toHTML(t):"",n=this.value.toHTML(t);return c(this,t&&t.parenthesis)&&(n='<span class="math-paranthesis math-round-parenthesis">(</span>'+n+'<span class="math-paranthesis math-round-parenthesis">)</span>'),e+r+'<span class="math-operator math-assignment-operator math-variable-assignment-operator math-binary-operator">=</span>'+n},u.prototype._toTex=function(t){var e=this.object.toTex(t),r=this.index?this.index.toTex(t):"",n=this.value.toTex(t);return c(this,t&&t.parenthesis)&&(n="\\left(".concat(n,"\\right)")),e+r+":="+n},u}};var Zt={name:"ResultSet",path:"type",factory:function(t,e,r,n){function o(t){if(!(this instanceof o))throw new SyntaxError("Constructor must be called with the new operator");this.entries=t||[]}return o.prototype.type="ResultSet",o.prototype.isResultSet=!0,o.prototype.valueOf=function(){return this.entries},o.prototype.toString=function(){return"["+this.entries.join(", ")+"]"},o.prototype.toJSON=function(){return{mathjs:"ResultSet",entries:this.entries}},o.fromJSON=function(t){return new o(t.entries)},o}},Gt=Nt.forEach,Kt=Nt.map;var Qt={name:"BlockNode",path:"expression.node",factory:function(t,e,r,n){var o=r(lt),i=r(Zt);function a(e){if(!(this instanceof a))throw new SyntaxError("Constructor must be called with the new operator");if(!Array.isArray(e))throw new Error("Array expected");this.blocks=e.map((function(e){var r=e&&e.node,n=!e||void 0===e.visible||e.visible;if(!t.isNode(r))throw new TypeError('Property "node" must be a Node');if("boolean"!=typeof n)throw new TypeError('Property "visible" must be a boolean');return{node:r,visible:n}}))}return a.prototype=new o,a.prototype.type="BlockNode",a.prototype.isBlockNode=!0,a.prototype._compile=function(t,e){var r=Kt(this.blocks,(function(r){return{eval:r.node._compile(t,e),visible:r.visible}}));return function(t,e,n){var o=[];return Gt(r,(function(r){var i=r.eval(t,e,n);r.visible&&o.push(i)})),new i(o)}},a.prototype.forEach=function(t){for(var e=0;e<this.blocks.length;e++)t(this.blocks[e].node,"blocks["+e+"].node",this)},a.prototype.map=function(t){for(var e=[],r=0;r<this.blocks.length;r++){var n=this.blocks[r],o=this._ifNode(t(n.node,"blocks["+r+"].node",this));e[r]={node:o,visible:n.visible}}return new a(e)},a.prototype.clone=function(){return new a(this.blocks.map((function(t){return{node:t.node,visible:t.visible}})))},a.prototype._toString=function(t){return this.blocks.map((function(e){return e.node.toString(t)+(e.visible?"":";")})).join("\n")},a.prototype.toJSON=function(){return{mathjs:"BlockNode",blocks:this.blocks}},a.fromJSON=function(t){return new a(t.blocks)},a.prototype.toHTML=function(t){return this.blocks.map((function(e){return e.node.toHTML(t)+(e.visible?"":'<span class="math-separator">;</span>')})).join('<span class="math-separator"><br /></span>')},a.prototype._toTex=function(t){return this.blocks.map((function(e){return e.node.toTex(t)+(e.visible?"":";")})).join("\\;\\;\n")},a}};var Yt={name:"ConditionalNode",path:"expression.node",factory:function(t,e,r,n){var o=r(lt),i=r(G);function a(e,r,n){if(!(this instanceof a))throw new SyntaxError("Constructor must be called with the new operator");if(!t.isNode(e))throw new TypeError("Parameter condition must be a Node");if(!t.isNode(r))throw new TypeError("Parameter trueExpr must be a Node");if(!t.isNode(n))throw new TypeError("Parameter falseExpr must be a Node");this.condition=e,this.trueExpr=r,this.falseExpr=n}return a.prototype=new o,a.prototype.type="ConditionalNode",a.prototype.isConditionalNode=!0,a.prototype._compile=function(e,r){var n=this.condition._compile(e,r),o=this.trueExpr._compile(e,r),a=this.falseExpr._compile(e,r);return function(e,r,s){return function(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e)return!!e;if(e){if(t.isBigNumber(e))return!e.isZero();if(t.isComplex(e))return!(!e.re&&!e.im);if(t.isUnit(e))return!!e.value}if(null==e)return!1;throw new TypeError('Unsupported type of condition "'+i(e)+'"')}(n(e,r,s))?o(e,r,s):a(e,r,s)}},a.prototype.forEach=function(t){t(this.condition,"condition",this),t(this.trueExpr,"trueExpr",this),t(this.falseExpr,"falseExpr",this)},a.prototype.map=function(t){return new a(this._ifNode(t(this.condition,"condition",this)),this._ifNode(t(this.trueExpr,"trueExpr",this)),this._ifNode(t(this.falseExpr,"falseExpr",this)))},a.prototype.clone=function(){return new a(this.condition,this.trueExpr,this.falseExpr)},a.prototype._toString=function(t){var e=t&&t.parenthesis?t.parenthesis:"keep",r=Ut.getPrecedence(this,e),n=this.condition.toString(t),o=Ut.getPrecedence(this.condition,e);("all"===e||"OperatorNode"===this.condition.type||null!==o&&o<=r)&&(n="("+n+")");var i=this.trueExpr.toString(t),a=Ut.getPrecedence(this.trueExpr,e);("all"===e||"OperatorNode"===this.trueExpr.type||null!==a&&a<=r)&&(i="("+i+")");var s=this.falseExpr.toString(t),u=Ut.getPrecedence(this.falseExpr,e);return("all"===e||"OperatorNode"===this.falseExpr.type||null!==u&&u<=r)&&(s="("+s+")"),n+" ? "+i+" : "+s},a.prototype.toJSON=function(){return{mathjs:"ConditionalNode",condition:this.condition,trueExpr:this.trueExpr,falseExpr:this.falseExpr}},a.fromJSON=function(t){return new a(t.condition,t.trueExpr,t.falseExpr)},a.prototype.toHTML=function(t){var e=t&&t.parenthesis?t.parenthesis:"keep",r=Ut.getPrecedence(this,e),n=this.condition.toHTML(t),o=Ut.getPrecedence(this.condition,e);("all"===e||"OperatorNode"===this.condition.type||null!==o&&o<=r)&&(n='<span class="math-parenthesis math-round-parenthesis">(</span>'+n+'<span class="math-parenthesis math-round-parenthesis">)</span>');var i=this.trueExpr.toHTML(t),a=Ut.getPrecedence(this.trueExpr,e);("all"===e||"OperatorNode"===this.trueExpr.type||null!==a&&a<=r)&&(i='<span class="math-parenthesis math-round-parenthesis">(</span>'+i+'<span class="math-parenthesis math-round-parenthesis">)</span>');var s=this.falseExpr.toHTML(t),u=Ut.getPrecedence(this.falseExpr,e);return("all"===e||"OperatorNode"===this.falseExpr.type||null!==u&&u<=r)&&(s='<span class="math-parenthesis math-round-parenthesis">(</span>'+s+'<span class="math-parenthesis math-round-parenthesis">)</span>'),n+'<span class="math-operator math-conditional-operator">?</span>'+i+'<span class="math-operator math-conditional-operator">:</span>'+s},a.prototype._toTex=function(t){return"\\begin{cases} {"+this.trueExpr.toTex(t)+"}, &\\quad{\\text{if }\\;"+this.condition.toTex(t)+"}\\\\{"+this.falseExpr.toTex(t)+"}, &\\quad{\\text{otherwise}}\\end{cases}"},a}},te=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},ee={"{":"\\{","}":"\\}","\\":"\\textbackslash{}","#":"\\#",$:"\\$","%":"\\%","&":"\\&","^":"\\textasciicircum{}",_:"\\_","~":"\\textasciitilde{}"},re={"–":"\\--","—":"\\---"," ":"~","\t":"\\qquad{}","\r\n":"\\newline{}","\n":"\\newline{}"},ne=function(t,e){return te({},t,e)},oe=E((function(t,e){e.symbols={Alpha:"A",alpha:"\\alpha",Beta:"B",beta:"\\beta",Gamma:"\\Gamma",gamma:"\\gamma",Delta:"\\Delta",delta:"\\delta",Epsilon:"E",epsilon:"\\epsilon",varepsilon:"\\varepsilon",Zeta:"Z",zeta:"\\zeta",Eta:"H",eta:"\\eta",Theta:"\\Theta",theta:"\\theta",vartheta:"\\vartheta",Iota:"I",iota:"\\iota",Kappa:"K",kappa:"\\kappa",varkappa:"\\varkappa",Lambda:"\\Lambda",lambda:"\\lambda",Mu:"M",mu:"\\mu",Nu:"N",nu:"\\nu",Xi:"\\Xi",xi:"\\xi",Omicron:"O",omicron:"o",Pi:"\\Pi",pi:"\\pi",varpi:"\\varpi",Rho:"P",rho:"\\rho",varrho:"\\varrho",Sigma:"\\Sigma",sigma:"\\sigma",varsigma:"\\varsigma",Tau:"T",tau:"\\tau",Upsilon:"\\Upsilon",upsilon:"\\upsilon",Phi:"\\Phi",phi:"\\phi",varphi:"\\varphi",Chi:"X",chi:"\\chi",Psi:"\\Psi",psi:"\\psi",Omega:"\\Omega",omega:"\\omega",true:"\\mathrm{True}",false:"\\mathrm{False}",i:"i",inf:"\\infty",Inf:"\\infty",infinity:"\\infty",Infinity:"\\infty",oo:"\\infty",lim:"\\lim",undefined:"\\mathbf{?}"},e.operators={transpose:"^\\top",ctranspose:"^H",factorial:"!",pow:"^",dotPow:".^\\wedge",unaryPlus:"+",unaryMinus:"-",bitNot:"\\~",not:"\\neg",multiply:"\\cdot",divide:"\\frac",dotMultiply:".\\cdot",dotDivide:".:",mod:"\\mod",add:"+",subtract:"-",to:"\\rightarrow",leftShift:"<<",rightArithShift:">>",rightLogShift:">>>",equal:"=",unequal:"\\neq",smaller:"<",larger:">",smallerEq:"\\leq",largerEq:"\\geq",bitAnd:"\\&",bitXor:"\\underline{|}",bitOr:"|",and:"\\wedge",xor:"\\veebar",or:"\\vee"},e.defaultTemplate="\\mathrm{${name}}\\left(${args}\\right)";var r={deg:"^\\circ"};e.escape=function(t){return function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.preserveFormatting,n=void 0!==r&&r,o=e.escapeMapFn,i=void 0===o?ne:o,a=String(t),s="",u=i(te({},ee),n?te({},re):{}),c=Object.keys(u),p=function(){var t=!1;c.forEach((function(e,r){t||a.length>=e.length&&a.slice(0,e.length)===e&&(s+=u[c[r]],a=a.slice(e.length,a.length),t=!0)})),t||(s+=a.slice(0,1),a=a.slice(1,a.length))};a;)p();return s}(t,{preserveFormatting:!0})},e.toSymbol=function(t,n){return(n=void 0!==n&&n)?r.hasOwnProperty(t)?r[t]:"\\mathrm{"+e.escape(t)+"}":e.symbols.hasOwnProperty(t)?e.symbols[t]:e.escape(t)}})),ie=(oe.symbols,oe.operators,oe.defaultTemplate,oe.escape,oe.toSymbol,vt.format),ae=oe.escape;var se={name:"ConstantNode",path:"expression.node",factory:function(t,e,r,n){var o=r(lt),i=r(G);function a(t){if(!(this instanceof a))throw new SyntaxError("Constructor must be called with the new operator");if(2===arguments.length)throw new SyntaxError("new ConstantNode(valueStr, valueType) is not supported anymore since math v4.0.0. Use new ConstantNode(value) instead, where value is a non-stringified value.");this.value=t}return a.prototype=new o,a.prototype.type="ConstantNode",a.prototype.isConstantNode=!0,a.prototype._compile=function(t,e){var r=this.value;return function(){return r}},a.prototype.forEach=function(t){},a.prototype.map=function(t){return this.clone()},a.prototype.clone=function(){return new a(this.value)},a.prototype._toString=function(t){return ie(this.value,t)},a.prototype.toHTML=function(t){var e=this._toString(t);switch(i(this.value)){case"number":case"BigNumber":case"Fraction":return'<span class="math-number">'+e+"</span>";case"string":return'<span class="math-string">'+e+"</span>";case"boolean":return'<span class="math-boolean">'+e+"</span>";case"null":return'<span class="math-null-symbol">'+e+"</span>";case"undefined":return'<span class="math-undefined">'+e+"</span>";default:return'<span class="math-symbol">'+e+"</span>"}},a.prototype.toJSON=function(){return{mathjs:"ConstantNode",value:this.value}},a.fromJSON=function(t){return new a(t.value)},a.prototype._toTex=function(t){var e=this._toString(t);switch(i(this.value)){case"string":return"\\mathtt{"+ae(e)+"}";case"number":case"BigNumber":var r=e.toLowerCase().indexOf("e");return-1!==r?e.substring(0,r)+"\\cdot10^{"+e.substring(r+1)+"}":e;case"Fraction":return this.value.toLatex();default:return e}},a}},ue=vt.escape,ce=Nt.forEach,pe=Nt.join,fe=ut.setSafeProperty;var he={name:"FunctionAssignmentNode",path:"expression.node",factory:function(t,e,r,n){var o=r(lt);function i(e,r,n){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if("string"!=typeof e)throw new TypeError('String expected for parameter "name"');if(!Array.isArray(r))throw new TypeError('Array containing strings or objects expected for parameter "params"');if(!t.isNode(n))throw new TypeError('Node expected for parameter "expr"');if(e in ct)throw new Error('Illegal function name, "'+e+'" is a reserved keyword');this.name=e,this.params=r.map((function(t){return t&&t.name||t})),this.types=r.map((function(t){return t&&t.type||"any"})),this.expr=n}function a(t,e){var r=Ut.getPrecedence(t,e),n=Ut.getPrecedence(t.expr,e);return"all"===e||null!==n&&n<=r}return i.prototype=new o,i.prototype.type="FunctionAssignmentNode",i.prototype.isFunctionAssignmentNode=!0,i.prototype._compile=function(t,e){var r=Object.create(e);ce(this.params,(function(t){r[t]=!0}));var o=this.expr._compile(t,r),i=this.name,a=this.params,s=pe(this.types,","),u=i+"("+pe(this.params,", ")+")";return function(t,e,r){var c={};c[s]=function(){for(var n=Object.create(e),i=0;i<a.length;i++)n[a[i]]=arguments[i];return o(t,n,r)};var p=n(i,c);return p.syntax=u,fe(t,i,p),p}},i.prototype.forEach=function(t){t(this.expr,"expr",this)},i.prototype.map=function(t){var e=this._ifNode(t(this.expr,"expr",this));return new i(this.name,this.params.slice(0),e)},i.prototype.clone=function(){return new i(this.name,this.params.slice(0),this.expr)},i.prototype._toString=function(t){var e=t&&t.parenthesis?t.parenthesis:"keep",r=this.expr.toString(t);return a(this,e)&&(r="("+r+")"),this.name+"("+this.params.join(", ")+") = "+r},i.prototype.toJSON=function(){var t=this.types;return{mathjs:"FunctionAssignmentNode",name:this.name,params:this.params.map((function(e,r){return{name:e,type:t[r]}})),expr:this.expr}},i.fromJSON=function(t){return new i(t.name,t.params,t.expr)},i.prototype.toHTML=function(t){for(var e=t&&t.parenthesis?t.parenthesis:"keep",r=[],n=0;n<this.params.length;n++)r.push('<span class="math-symbol math-parameter">'+ue(this.params[n])+"</span>");var o=this.expr.toHTML(t);return a(this,e)&&(o='<span class="math-parenthesis math-round-parenthesis">(</span>'+o+'<span class="math-parenthesis math-round-parenthesis">)</span>'),'<span class="math-function">'+ue(this.name)+'</span><span class="math-parenthesis math-round-parenthesis">(</span>'+r.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-round-parenthesis">)</span><span class="math-operator math-assignment-operator math-variable-assignment-operator math-binary-operator">=</span>'+o},i.prototype._toTex=function(t){var e=t&&t.parenthesis?t.parenthesis:"keep",r=this.expr.toTex(t);return a(this,e)&&(r="\\left(".concat(r,"\\right)")),"\\mathrm{"+this.name+"}\\left("+this.params.map(oe.toSymbol).join(",")+"\\right):="+r},i}};var le={name:"Range",path:"type",factory:function(t,e,r,n){function o(e,r,n){if(!(this instanceof o))throw new SyntaxError("Constructor must be called with the new operator");var i=null!=e,a=null!=r,s=null!=n;if(i)if(t.isBigNumber(e))e=e.toNumber();else if("number"!=typeof e)throw new TypeError("Parameter start must be a number");if(a)if(t.isBigNumber(r))r=r.toNumber();else if("number"!=typeof r)throw new TypeError("Parameter end must be a number");if(s)if(t.isBigNumber(n))n=n.toNumber();else if("number"!=typeof n)throw new TypeError("Parameter step must be a number");this.start=i?parseFloat(e):0,this.end=a?parseFloat(r):0,this.step=s?parseFloat(n):1}return o.prototype.type="Range",o.prototype.isRange=!0,o.parse=function(t){if("string"!=typeof t)return null;var e=t.split(":").map((function(t){return parseFloat(t)}));if(e.some((function(t){return isNaN(t)})))return null;switch(e.length){case 2:return new o(e[0],e[1]);case 3:return new o(e[0],e[2],e[1]);default:return null}},o.prototype.clone=function(){return new o(this.start,this.end,this.step)},o.prototype.size=function(){var t=0,e=this.start,r=this.step,n=this.end-e;return j.sign(r)===j.sign(n)?t=Math.ceil(n/r):0===n&&(t=0),isNaN(t)&&(t=0),[t]},o.prototype.min=function(){var t=this.size()[0];return t>0?this.step>0?this.start:this.start+(t-1)*this.step:void 0},o.prototype.max=function(){var t=this.size()[0];return t>0?this.step>0?this.start+(t-1)*this.step:this.start:void 0},o.prototype.forEach=function(t){var e=this.start,r=this.step,n=this.end,o=0;if(r>0)for(;e<n;)t(e,[o],this),e+=r,o++;else if(r<0)for(;e>n;)t(e,[o],this),e+=r,o++},o.prototype.map=function(t){var e=[];return this.forEach((function(r,n,o){e[n[0]]=t(r,n,o)})),e},o.prototype.toArray=function(){var t=[];return this.forEach((function(e,r){t[r[0]]=e})),t},o.prototype.valueOf=function(){return this.toArray()},o.prototype.format=function(t){var e=j.format(this.start,t);return 1!==this.step&&(e+=":"+j.format(this.step,t)),e+=":"+j.format(this.end,t)},o.prototype.toString=function(){return this.format()},o.prototype.toJSON=function(){return{mathjs:"Range",start:this.start,end:this.end,step:this.step}},o.fromJSON=function(t){return new o(t.start,t.end,t.step)},o}},me=Nt.map,de=vt.escape;var ye={name:"IndexNode",path:"expression.node",factory:function(t,e,r,n){var o=r(lt),i=r(le),a=Array.isArray;function s(e,r){if(!(this instanceof s))throw new SyntaxError("Constructor must be called with the new operator");if(this.dimensions=e,this.dotNotation=r||!1,!a(e)||!e.every(t.isNode))throw new TypeError('Array containing Nodes expected for parameter "dimensions"');if(this.dotNotation&&!this.isObjectProperty())throw new Error("dotNotation only applicable for object properties");var n=function(){throw new Error("Property `IndexNode.object` is deprecated, use `IndexNode.fn` instead")};Object.defineProperty(this,"object",{get:n,set:n})}function u(e,r,n){return new i(t.isBigNumber(e)?e.toNumber():e,t.isBigNumber(r)?r.toNumber():r,t.isBigNumber(n)?n.toNumber():n)}return s.prototype=new o,s.prototype.type="IndexNode",s.prototype.isIndexNode=!0,s.prototype._compile=function(e,r){var n=me(this.dimensions,(function(n,o){if(t.isRangeNode(n)){if(n.needsEnd()){var i=Object.create(r);i.end=!0;var a=n.start._compile(e,i),s=n.end._compile(e,i),c=n.step?n.step._compile(e,i):function(){return 1};return function(t,r,n){var i=e.size(n).valueOf(),p=Object.create(r);return p.end=i[o],u(a(t,p,n),s(t,p,n),c(t,p,n))}}var p=n.start._compile(e,r),f=n.end._compile(e,r),h=n.step?n.step._compile(e,r):function(){return 1};return function(t,e,r){return u(p(t,e,r),f(t,e,r),h(t,e,r))}}if(t.isSymbolNode(n)&&"end"===n.name){var l=Object.create(r);l.end=!0;var m=n._compile(e,l);return function(t,r,n){var i=e.size(n).valueOf(),a=Object.create(r);return a.end=i[o],m(t,a,n)}}var d=n._compile(e,r);return function(t,e,r){return d(t,e,r)}}));return function(t,r,o){var i=me(n,(function(e){return e(t,r,o)}));return e.index.apply(e,i)}},s.prototype.forEach=function(t){for(var e=0;e<this.dimensions.length;e++)t(this.dimensions[e],"dimensions["+e+"]",this)},s.prototype.map=function(t){for(var e=[],r=0;r<this.dimensions.length;r++)e[r]=this._ifNode(t(this.dimensions[r],"dimensions["+r+"]",this));return new s(e)},s.prototype.clone=function(){return new s(this.dimensions.slice(0))},s.prototype.isObjectProperty=function(){return 1===this.dimensions.length&&t.isConstantNode(this.dimensions[0])&&"string"==typeof this.dimensions[0].value},s.prototype.getObjectProperty=function(){return this.isObjectProperty()?this.dimensions[0].value:null},s.prototype._toString=function(t){return this.dotNotation?"."+this.getObjectProperty():"["+this.dimensions.join(", ")+"]"},s.prototype.toJSON=function(){return{mathjs:"IndexNode",dimensions:this.dimensions,dotNotation:this.dotNotation}},s.fromJSON=function(t){return new s(t.dimensions,t.dotNotation)},s.prototype.toHTML=function(t){for(var e=[],r=0;r<this.dimensions.length;r++)e[r]=this.dimensions[r].toHTML();return this.dotNotation?'<span class="math-operator math-accessor-operator">.</span><span class="math-symbol math-property">'+de(this.getObjectProperty())+"</span>":'<span class="math-parenthesis math-square-parenthesis">[</span>'+e.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-square-parenthesis">]</span>'},s.prototype._toTex=function(t){var e=this.dimensions.map((function(e){return e.toTex(t)}));return this.dotNotation?"."+this.getObjectProperty():"_{"+e.join(",")+"}"},s}};function ge(t){return(ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var ve=vt.stringify,we=vt.escape,be=ut.isSafeProperty,xe=O.hasOwnProperty;var Ne={name:"ObjectNode",path:"expression.node",factory:function(t,e,r,n){var o=r(lt);function i(e){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if(this.properties=e||{},e&&("object"!==ge(e)||!Object.keys(e).every((function(r){return t.isNode(e[r])}))))throw new TypeError("Object containing Nodes expected")}return i.prototype=new o,i.prototype.type="ObjectNode",i.prototype.isObjectNode=!0,i.prototype._compile=function(t,e){var r={};for(var n in this.properties)if(xe(this.properties,n)){var o=ve(n),i=JSON.parse(o);if(!be(this.properties,i))throw new Error('No access to property "'+i+'"');r[i]=this.properties[n]._compile(t,e)}return function(t,e,n){var o={};for(var i in r)xe(r,i)&&(o[i]=r[i](t,e,n));return o}},i.prototype.forEach=function(t){for(var e in this.properties)this.properties.hasOwnProperty(e)&&t(this.properties[e],"properties["+ve(e)+"]",this)},i.prototype.map=function(t){var e={};for(var r in this.properties)this.properties.hasOwnProperty(r)&&(e[r]=this._ifNode(t(this.properties[r],"properties["+ve(r)+"]",this)));return new i(e)},i.prototype.clone=function(){var t={};for(var e in this.properties)this.properties.hasOwnProperty(e)&&(t[e]=this.properties[e]);return new i(t)},i.prototype._toString=function(t){var e=[];for(var r in this.properties)this.properties.hasOwnProperty(r)&&e.push(ve(r)+": "+this.properties[r].toString(t));return"{"+e.join(", ")+"}"},i.prototype.toJSON=function(){return{mathjs:"ObjectNode",properties:this.properties}},i.fromJSON=function(t){return new i(t.properties)},i.prototype.toHTML=function(t){var e=[];for(var r in this.properties)this.properties.hasOwnProperty(r)&&e.push('<span class="math-symbol math-property">'+we(r)+'</span><span class="math-operator math-assignment-operator math-property-assignment-operator math-binary-operator">:</span>'+this.properties[r].toHTML(t));return'<span class="math-parenthesis math-curly-parenthesis">{</span>'+e.join('<span class="math-separator">,</span>')+'<span class="math-parenthesis math-curly-parenthesis">}</span>'},i.prototype._toTex=function(t){var e=[];for(var r in this.properties)this.properties.hasOwnProperty(r)&&e.push("\\mathbf{"+r+":} & "+this.properties[r].toTex(t)+"\\\\");return"\\left\\{\\begin{array}{ll}".concat(e.join("\n"),"\\end{array}\\right\\}")},i}},Ee=Nt.map,Se=vt.escape,Oe=ut.isSafeMethod,Ae=ut.getSafeProperty;var je={name:"OperatorNode",path:"expression.node",factory:function(t,e,r,n){var o=r(lt);function i(e,r,n,o){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if("string"!=typeof e)throw new TypeError('string expected for parameter "op"');if("string"!=typeof r)throw new TypeError('string expected for parameter "fn"');if(!Array.isArray(n)||!n.every(t.isNode))throw new TypeError('Array containing Nodes expected for parameter "args"');this.implicit=!0===o,this.op=e,this.fn=r,this.args=n||[]}function a(t,e,r,n,o){var i,a=Ut.getPrecedence(t,e),s=Ut.getAssociativity(t,e);if("all"===e||n.length>2&&"OperatorNode:add"!==t.getIdentifier()&&"OperatorNode:multiply"!==t.getIdentifier())return n.map((function(t){switch(t.getContent().type){case"ArrayNode":case"ConstantNode":case"SymbolNode":case"ParenthesisNode":return!1;default:return!0}}));switch(n.length){case 0:i=[];break;case 1:var u=Ut.getPrecedence(n[0],e);if(o&&null!==u){var c,p;if("keep"===e?(c=n[0].getIdentifier(),p=t.getIdentifier()):(c=n[0].getContent().getIdentifier(),p=t.getContent().getIdentifier()),!1===Ut.properties[a][p].latexLeftParens){i=[!1];break}if(!1===Ut.properties[u][c].latexParens){i=[!1];break}}if(null===u){i=[!1];break}if(u<=a){i=[!0];break}i=[!1];break;case 2:var f,h,l=Ut.getPrecedence(n[0],e),m=Ut.isAssociativeWith(t,n[0],e);f=null!==l&&(l===a&&"right"===s&&!m||l<a);var d,y,g,v=Ut.getPrecedence(n[1],e),w=Ut.isAssociativeWith(t,n[1],e);if(h=null!==v&&(v===a&&"left"===s&&!w||v<a),o)"keep"===e?(d=t.getIdentifier(),y=t.args[0].getIdentifier(),g=t.args[1].getIdentifier()):(d=t.getContent().getIdentifier(),y=t.args[0].getContent().getIdentifier(),g=t.args[1].getContent().getIdentifier()),null!==l&&(!1===Ut.properties[a][d].latexLeftParens&&(f=!1),!1===Ut.properties[l][y].latexParens&&(f=!1)),null!==v&&(!1===Ut.properties[a][d].latexRightParens&&(h=!1),!1===Ut.properties[v][g].latexParens&&(h=!1));i=[f,h];break;default:"OperatorNode:add"!==t.getIdentifier()&&"OperatorNode:multiply"!==t.getIdentifier()||(i=n.map((function(r){var n=Ut.getPrecedence(r,e),o=Ut.isAssociativeWith(t,r,e),i=Ut.getAssociativity(r,e);return null!==n&&(a===n&&s===i&&!o||n<a)})))}return n.length>=2&&"OperatorNode:multiply"===t.getIdentifier()&&t.implicit&&"auto"===e&&"hide"===r&&(i=n.map((function(t,e){var r="ParenthesisNode"===t.getIdentifier();return!(!i[e]&&!r)}))),i}return i.prototype=new o,i.prototype.type="OperatorNode",i.prototype.isOperatorNode=!0,i.prototype._compile=function(t,e){if("string"!=typeof this.fn||!Oe(t,this.fn))throw t[this.fn]?new Error('No access to function "'+this.fn+'"'):new Error("Function "+this.fn+' missing in provided namespace "math"');var r=Ae(t,this.fn),n=Ee(this.args,(function(r){return r._compile(t,e)}));if(1===n.length){var o=n[0];return function(t,e,n){return r(o(t,e,n))}}if(2===n.length){var i=n[0],a=n[1];return function(t,e,n){return r(i(t,e,n),a(t,e,n))}}return function(t,e,o){return r.apply(null,Ee(n,(function(r){return r(t,e,o)})))}},i.prototype.forEach=function(t){for(var e=0;e<this.args.length;e++)t(this.args[e],"args["+e+"]",this)},i.prototype.map=function(t){for(var e=[],r=0;r<this.args.length;r++)e[r]=this._ifNode(t(this.args[r],"args["+r+"]",this));return new i(this.op,this.fn,e,this.implicit)},i.prototype.clone=function(){return new i(this.op,this.fn,this.args.slice(0),this.implicit)},i.prototype.isUnary=function(){return 1===this.args.length},i.prototype.isBinary=function(){return 2===this.args.length},i.prototype._toString=function(t){var e=t&&t.parenthesis?t.parenthesis:"keep",r=t&&t.implicit?t.implicit:"hide",n=this.args,o=a(this,e,r,n,!1);if(1===n.length){var i=Ut.getAssociativity(this,e),s=n[0].toString(t);o[0]&&(s="("+s+")");var u=/[a-zA-Z]+/.test(this.op);return"right"===i?this.op+(u?" ":"")+s:"left"===i?s+(u?" ":"")+this.op:s+this.op}if(2===n.length){var c=n[0].toString(t),p=n[1].toString(t);return o[0]&&(c="("+c+")"),o[1]&&(p="("+p+")"),this.implicit&&"OperatorNode:multiply"===this.getIdentifier()&&"hide"===r?c+" "+p:c+" "+this.op+" "+p}if(n.length>2&&("OperatorNode:add"===this.getIdentifier()||"OperatorNode:multiply"===this.getIdentifier())){var f=n.map((function(e,r){return e=e.toString(t),o[r]&&(e="("+e+")"),e}));return this.implicit&&"OperatorNode:multiply"===this.getIdentifier()&&"hide"===r?f.join(" "):f.join(" "+this.op+" ")}return this.fn+"("+this.args.join(", ")+")"},i.prototype.toJSON=function(){return{mathjs:"OperatorNode",op:this.op,fn:this.fn,args:this.args,implicit:this.implicit}},i.fromJSON=function(t){return new i(t.op,t.fn,t.args,t.implicit)},i.prototype.toHTML=function(t){var e=t&&t.parenthesis?t.parenthesis:"keep",r=t&&t.implicit?t.implicit:"hide",n=this.args,o=a(this,e,r,n,!1);if(1===n.length){var i=Ut.getAssociativity(this,e),s=n[0].toHTML(t);return o[0]&&(s='<span class="math-parenthesis math-round-parenthesis">(</span>'+s+'<span class="math-parenthesis math-round-parenthesis">)</span>'),"right"===i?'<span class="math-operator math-unary-operator math-lefthand-unary-operator">'+Se(this.op)+"</span>"+s:s+'<span class="math-operator math-unary-operator math-righthand-unary-operator">'+Se(this.op)+"</span>"}if(2===n.length){var u=n[0].toHTML(t),c=n[1].toHTML(t);return o[0]&&(u='<span class="math-parenthesis math-round-parenthesis">(</span>'+u+'<span class="math-parenthesis math-round-parenthesis">)</span>'),o[1]&&(c='<span class="math-parenthesis math-round-parenthesis">(</span>'+c+'<span class="math-parenthesis math-round-parenthesis">)</span>'),this.implicit&&"OperatorNode:multiply"===this.getIdentifier()&&"hide"===r?u+'<span class="math-operator math-binary-operator math-implicit-binary-operator"></span>'+c:u+'<span class="math-operator math-binary-operator math-explicit-binary-operator">'+Se(this.op)+"</span>"+c}var p=n.map((function(e,r){return e=e.toHTML(t),o[r]&&(e='<span class="math-parenthesis math-round-parenthesis">(</span>'+e+'<span class="math-parenthesis math-round-parenthesis">)</span>'),e}));return n.length>2&&("OperatorNode:add"===this.getIdentifier()||"OperatorNode:multiply"===this.getIdentifier())?this.implicit&&"OperatorNode:multiply"===this.getIdentifier()&&"hide"===r?p.join('<span class="math-operator math-binary-operator math-implicit-binary-operator"></span>'):p.join('<span class="math-operator math-binary-operator math-explicit-binary-operator">'+Se(this.op)+"</span>"):'<span class="math-function">'+Se(this.fn)+'</span><span class="math-paranthesis math-round-parenthesis">(</span>'+p.join('<span class="math-separator">,</span>')+'<span class="math-paranthesis math-round-parenthesis">)</span>'},i.prototype._toTex=function(t){var e=t&&t.parenthesis?t.parenthesis:"keep",r=t&&t.implicit?t.implicit:"hide",n=this.args,o=a(this,e,r,n,!0),i=oe.operators[this.fn];if(i=void 0===i?this.op:i,1===n.length){var s=Ut.getAssociativity(this,e),u=n[0].toTex(t);return o[0]&&(u="\\left(".concat(u,"\\right)")),"right"===s?i+u:u+i}if(2===n.length){var c=n[0],p=c.toTex(t);o[0]&&(p="\\left(".concat(p,"\\right)"));var f,h=n[1].toTex(t);switch(o[1]&&(h="\\left(".concat(h,"\\right)")),f="keep"===e?c.getIdentifier():c.getContent().getIdentifier(),this.getIdentifier()){case"OperatorNode:divide":return i+"{"+p+"}{"+h+"}";case"OperatorNode:pow":switch(p="{"+p+"}",h="{"+h+"}",f){case"ConditionalNode":case"OperatorNode:divide":p="\\left(".concat(p,"\\right)")}break;case"OperatorNode:multiply":if(this.implicit&&"hide"===r)return p+"~"+h}return p+i+h}if(n.length>2&&("OperatorNode:add"===this.getIdentifier()||"OperatorNode:multiply"===this.getIdentifier())){var l=n.map((function(e,r){return e=e.toTex(t),o[r]&&(e="\\left(".concat(e,"\\right)")),e}));return"OperatorNode:multiply"===this.getIdentifier()&&this.implicit?l.join("~"):l.join(i)}return"\\mathrm{"+this.fn+"}\\left("+n.map((function(e){return e.toTex(t)})).join(",")+"\\right)"},i.prototype.getIdentifier=function(){return this.type+":"+this.fn},i}};var Te={name:"ParenthesisNode",path:"expression.node",factory:function(t,e,r,n){var o=r(lt);function i(e){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if(!t.isNode(e))throw new TypeError('Node expected for parameter "content"');this.content=e}return i.prototype=new o,i.prototype.type="ParenthesisNode",i.prototype.isParenthesisNode=!0,i.prototype._compile=function(t,e){return this.content._compile(t,e)},i.prototype.getContent=function(){return this.content.getContent()},i.prototype.forEach=function(t){t(this.content,"content",this)},i.prototype.map=function(t){return new i(t(this.content,"content",this))},i.prototype.clone=function(){return new i(this.content)},i.prototype._toString=function(t){return!t||t&&!t.parenthesis||t&&"keep"===t.parenthesis?"("+this.content.toString(t)+")":this.content.toString(t)},i.prototype.toJSON=function(){return{mathjs:"ParenthesisNode",content:this.content}},i.fromJSON=function(t){return new i(t.content)},i.prototype.toHTML=function(t){return!t||t&&!t.parenthesis||t&&"keep"===t.parenthesis?'<span class="math-parenthesis math-round-parenthesis">(</span>'+this.content.toHTML(t)+'<span class="math-parenthesis math-round-parenthesis">)</span>':this.content.toHTML(t)},i.prototype._toTex=function(t){return!t||t&&!t.parenthesis||t&&"keep"===t.parenthesis?"\\left(".concat(this.content.toTex(t),"\\right)"):this.content.toTex(t)},i}},ke=vt.escape,Pe=O.hasOwnProperty,Ce=ut.getSafeProperty;var Me={name:"SymbolNode",path:"expression.node",math:!0,factory:function(t,e,r,n,o){var i=r(lt);function a(e){return!!t.Unit&&t.Unit.isValuelessUnit(e)}function s(t){if(!(this instanceof s))throw new SyntaxError("Constructor must be called with the new operator");if("string"!=typeof t)throw new TypeError('String expected for parameter "name"');this.name=t}return s.prototype=new i,s.prototype.type="SymbolNode",s.prototype.isSymbolNode=!0,s.prototype._compile=function(e,r){var n=this.name;if(Pe(r,n))return function(t,e,r){return e[n]};if(n in e)return function(t,r,o){return Ce(n in t?t:e,n)};var o=a(n);return function(e,r,i){return n in e?Ce(e,n):o?new t.Unit(null,n):function(t){throw new Error("Undefined symbol "+t)}(n)}},s.prototype.forEach=function(t){},s.prototype.map=function(t){return this.clone()},s.prototype.clone=function(){return new s(this.name)},s.prototype._toString=function(t){return this.name},s.prototype.toHTML=function(t){var e=ke(this.name);return"true"===e||"false"===e?'<span class="math-symbol math-boolean">'+e+"</span>":"i"===e?'<span class="math-symbol math-imaginary-symbol">'+e+"</span>":"Infinity"===e?'<span class="math-symbol math-infinity-symbol">'+e+"</span>":"NaN"===e?'<span class="math-symbol math-nan-symbol">'+e+"</span>":"null"===e?'<span class="math-symbol math-null-symbol">'+e+"</span>":"undefined"===e?'<span class="math-symbol math-undefined-symbol">'+e+"</span>":'<span class="math-symbol">'+e+"</span>"},s.prototype.toJSON=function(){return{mathjs:"SymbolNode",name:this.name}},s.fromJSON=function(t){return new s(t.name)},s.prototype._toTex=function(t){var e=!1;void 0===o[this.name]&&a(this.name)&&(e=!0);var r=oe.toSymbol(this.name,e);return"\\"===r[0]?r:" "+r},s}};function Fe(t){return(Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _e(){return(_e=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}).apply(this,arguments)}var Ie=oe,De=vt.escape,Le=O.hasOwnProperty,Je=Nt.map,Re=ut.validateSafeMethod,qe=ut.getSafeProperty;var Be={name:"FunctionNode",path:"expression.node",math:!0,factory:function(t,e,r,n,o){var i=r(lt),a=r(Me);function s(e,r){if(!(this instanceof s))throw new SyntaxError("Constructor must be called with the new operator");if("string"==typeof e&&(e=new a(e)),!t.isNode(e))throw new TypeError('Node expected as parameter "fn"');if(!Array.isArray(r)||!r.every(t.isNode))throw new TypeError('Array containing Nodes expected for parameter "args"');this.fn=e,this.args=r||[],Object.defineProperty(this,"name",{get:function(){return this.fn.name||""}.bind(this),set:function(){throw new Error("Cannot assign a new name, name is read-only")}});var n=function(){throw new Error("Property `FunctionNode.object` is deprecated, use `FunctionNode.fn` instead")};Object.defineProperty(this,"object",{get:n,set:n})}s.prototype=new i,s.prototype.type="FunctionNode",s.prototype.isFunctionNode=!0,s.prototype._compile=function(e,r){if(!(this instanceof s))throw new TypeError("No valid FunctionNode");var n=Je(this.args,(function(t){return t._compile(e,r)}));if(t.isSymbolNode(this.fn)){var o=this.fn.name,i=o in e?qe(e,o):void 0;if("function"==typeof i&&!0===i.rawArgs){var a=this.args;return function(t,r,n){return(o in t?qe(t,o):i)(a,e,_e({},t,r))}}if(1===n.length){var u=n[0];return function(t,e,r){return(o in t?qe(t,o):i)(u(t,e,r))}}if(2===n.length){var c=n[0],p=n[1];return function(t,e,r){return(o in t?qe(t,o):i)(c(t,e,r),p(t,e,r))}}return function(t,e,r){return(o in t?qe(t,o):i).apply(null,Je(n,(function(n){return n(t,e,r)})))}}if(t.isAccessorNode(this.fn)&&t.isIndexNode(this.fn.index)&&this.fn.index.isObjectProperty()){var f=this.fn.object._compile(e,r),h=this.fn.index.getObjectProperty(),l=this.args;return function(t,r,o){var i=f(t,r,o);return Re(i,h),i[h]&&i[h].rawArgs?i[h](l,e,_e({},t,r)):i[h].apply(i,Je(n,(function(e){return e(t,r,o)})))}}var m=this.fn._compile(e,r),d=this.args;return function(t,r,o){var i=m(t,r,o);return i&&i.rawArgs?i(d,e,_e({},t,r)):i.apply(i,Je(n,(function(e){return e(t,r,o)})))}},s.prototype.forEach=function(t){t(this.fn,"fn",this);for(var e=0;e<this.args.length;e++)t(this.args[e],"args["+e+"]",this)},s.prototype.map=function(t){for(var e=this._ifNode(t(this.fn,"fn",this)),r=[],n=0;n<this.args.length;n++)r[n]=this._ifNode(t(this.args[n],"args["+n+"]",this));return new s(e,r)},s.prototype.clone=function(){return new s(this.fn,this.args.slice(0))};var u=s.prototype.toString;function c(e,r,n){for(var o,i="",a=new RegExp("\\$(?:\\{([a-z_][a-z_0-9]*)(?:\\[([0-9]+)\\])?\\}|\\$)","ig"),s=0;null!==(o=a.exec(e));)if(i+=e.substring(s,o.index),s=o.index,"$$"===o[0])i+="$",s++;else{s+=o[0].length;var u=r[o[1]];if(!u)throw new ReferenceError("Template: Property "+o[1]+" does not exist.");if(void 0===o[2])switch(Fe(u)){case"string":i+=u;break;case"object":if(t.isNode(u))i+=u.toTex(n);else{if(!Array.isArray(u))throw new TypeError("Template: "+o[1]+" has to be a Node, String or array of Nodes");i+=u.map((function(e,r){if(t.isNode(e))return e.toTex(n);throw new TypeError("Template: "+o[1]+"["+r+"] is not a Node.")})).join(",")}break;default:throw new TypeError("Template: "+o[1]+" has to be a Node, String or array of Nodes")}else{if(!t.isNode(u[o[2]]&&u[o[2]]))throw new TypeError("Template: "+o[1]+"["+o[2]+"] is not a Node.");i+=u[o[2]].toTex(n)}}return i+=e.slice(s)}s.prototype.toString=function(t){var e,r=this.fn.toString(t);return t&&"object"===Fe(t.handler)&&Le(t.handler,r)&&(e=t.handler[r](this,t)),void 0!==e?e:u.call(this,t)},s.prototype._toString=function(e){var r=this.args.map((function(t){return t.toString(e)}));return(t.isFunctionAssignmentNode(this.fn)?"("+this.fn.toString(e)+")":this.fn.toString(e))+"("+r.join(", ")+")"},s.prototype.toJSON=function(){return{mathjs:"FunctionNode",fn:this.fn,args:this.args}},s.fromJSON=function(t){return new s(t.fn,t.args)},s.prototype.toHTML=function(t){var e=this.args.map((function(e){return e.toHTML(t)}));return'<span class="math-function">'+De(this.fn)+'</span><span class="math-paranthesis math-round-parenthesis">(</span>'+e.join('<span class="math-separator">,</span>')+'<span class="math-paranthesis math-round-parenthesis">)</span>'};var p=s.prototype.toTex;return s.prototype.toTex=function(t){var e;return t&&"object"===Fe(t.handler)&&Le(t.handler,this.name)&&(e=t.handler[this.name](this,t)),void 0!==e?e:p.call(this,t)},s.prototype._toTex=function(t){var e,r,n=this.args.map((function(e){return e.toTex(t)}));switch(!o[this.name]||"function"!=typeof o[this.name].toTex&&"object"!==Fe(o[this.name].toTex)&&"string"!=typeof o[this.name].toTex||(e=o[this.name].toTex),Fe(e)){case"function":r=e(this,t);break;case"string":r=c(e,this,t);break;case"object":switch(Fe(e[n.length])){case"function":r=e[n.length](this,t);break;case"string":r=c(e[n.length],this,t)}}return void 0!==r?r:c(Ie.defaultTemplate,this,t)},s.prototype.getIdentifier=function(){return this.type+":"+this.name},s}};var He={name:"RangeNode",path:"expression.node",factory:function(t,e,r,n){var o=r(lt);function i(e,r,n){if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if(!t.isNode(e))throw new TypeError("Node expected");if(!t.isNode(r))throw new TypeError("Node expected");if(n&&!t.isNode(n))throw new TypeError("Node expected");if(arguments.length>3)throw new Error("Too many arguments");this.start=e,this.end=r,this.step=n||null}function a(t,e){var r=Ut.getPrecedence(t,e),n={},o=Ut.getPrecedence(t.start,e);if(n.start=null!==o&&o<=r||"all"===e,t.step){var i=Ut.getPrecedence(t.step,e);n.step=null!==i&&i<=r||"all"===e}var a=Ut.getPrecedence(t.end,e);return n.end=null!==a&&a<=r||"all"===e,n}return i.prototype=new o,i.prototype.type="RangeNode",i.prototype.isRangeNode=!0,i.prototype.needsEnd=function(){return this.filter((function(e){return t.isSymbolNode(e)&&"end"===e.name})).length>0},i.prototype._compile=function(t,e){var r=t.range,n=this.start._compile(t,e),o=this.end._compile(t,e);if(this.step){var i=this.step._compile(t,e);return function(t,e,a){return r(n(t,e,a),o(t,e,a),i(t,e,a))}}return function(t,e,i){return r(n(t,e,i),o(t,e,i))}},i.prototype.forEach=function(t){t(this.start,"start",this),t(this.end,"end",this),this.step&&t(this.step,"step",this)},i.prototype.map=function(t){return new i(this._ifNode(t(this.start,"start",this)),this._ifNode(t(this.end,"end",this)),this.step&&this._ifNode(t(this.step,"step",this)))},i.prototype.clone=function(){return new i(this.start,this.end,this.step&&this.step)},i.prototype._toString=function(t){var e,r=a(this,t&&t.parenthesis?t.parenthesis:"keep"),n=this.start.toString(t);if(r.start&&(n="("+n+")"),e=n,this.step){var o=this.step.toString(t);r.step&&(o="("+o+")"),e+=":"+o}var i=this.end.toString(t);return r.end&&(i="("+i+")"),e+=":"+i},i.prototype.toJSON=function(){return{mathjs:"RangeNode",start:this.start,end:this.end,step:this.step}},i.fromJSON=function(t){return new i(t.start,t.end,t.step)},i.prototype.toHTML=function(t){var e,r=a(this,t&&t.parenthesis?t.parenthesis:"keep"),n=this.start.toHTML(t);if(r.start&&(n='<span class="math-parenthesis math-round-parenthesis">(</span>'+n+'<span class="math-parenthesis math-round-parenthesis">)</span>'),e=n,this.step){var o=this.step.toHTML(t);r.step&&(o='<span class="math-parenthesis math-round-parenthesis">(</span>'+o+'<span class="math-parenthesis math-round-parenthesis">)</span>'),e+='<span class="math-operator math-range-operator">:</span>'+o}var i=this.end.toHTML(t);return r.end&&(i='<span class="math-parenthesis math-round-parenthesis">(</span>'+i+'<span class="math-parenthesis math-round-parenthesis">)</span>'),e+='<span class="math-operator math-range-operator">:</span>'+i},i.prototype._toTex=function(t){var e=a(this,t&&t.parenthesis?t.parenthesis:"keep"),r=this.start.toTex(t);if(e.start&&(r="\\left(".concat(r,"\\right)")),this.step){var n=this.step.toTex(t);e.step&&(n="\\left(".concat(n,"\\right)")),r+=":"+n}var o=this.end.toTex(t);return e.end&&(o="\\left(".concat(o,"\\right)")),r+=":"+o},i}},We=vt.escape;var ze={name:"RelationalNode",path:"expression.node",factory:function(t,e,r,n){var o=r(lt),i=ut.getSafeProperty;function a(t,e){if(!(this instanceof a))throw new SyntaxError("Constructor must be called with the new operator");if(!Array.isArray(t))throw new TypeError("Parameter conditionals must be an array");if(!Array.isArray(e))throw new TypeError("Parameter params must be an array");if(t.length!==e.length-1)throw new TypeError("Parameter params must contain exactly one more element than parameter conditionals");this.conditionals=t,this.params=e}return a.prototype=new o,a.prototype.type="RelationalNode",a.prototype.isRelationalNode=!0,a.prototype._compile=function(t,e){var r=this,n=this.params.map((function(r){return r._compile(t,e)}));return function(e,o,a){for(var s,u=n[0](e,o,a),c=0;c<r.conditionals.length;c++){if(s=u,u=n[c+1](e,o,a),!i(t,r.conditionals[c])(s,u))return!1}return!0}},a.prototype.forEach=function(t){var e=this;this.params.forEach((function(r,n){return t(r,"params["+n+"]",e)}),this)},a.prototype.map=function(t){var e=this;return new a(this.conditionals.slice(),this.params.map((function(r,n){return e._ifNode(t(r,"params["+n+"]",e))}),this))},a.prototype.clone=function(){return new a(this.conditionals,this.params)},a.prototype._toString=function(t){for(var e=t&&t.parenthesis?t.parenthesis:"keep",r=Ut.getPrecedence(this,e),n=this.params.map((function(n,o){var i=Ut.getPrecedence(n,e);return"all"===e||null!==i&&i<=r?"("+n.toString(t)+")":n.toString(t)})),o={equal:"==",unequal:"!=",smaller:"<",larger:">",smallerEq:"<=",largerEq:">="},i=n[0],a=0;a<this.conditionals.length;a++)i+=" "+o[this.conditionals[a]]+" "+n[a+1];return i},a.prototype.toJSON=function(){return{mathjs:"RelationalNode",conditionals:this.conditionals,params:this.params}},a.fromJSON=function(t){return new a(t.conditionals,t.params)},a.prototype.toHTML=function(t){for(var e=t&&t.parenthesis?t.parenthesis:"keep",r=Ut.getPrecedence(this,e),n=this.params.map((function(n,o){var i=Ut.getPrecedence(n,e);return"all"===e||null!==i&&i<=r?'<span class="math-parenthesis math-round-parenthesis">(</span>'+n.toHTML(t)+'<span class="math-parenthesis math-round-parenthesis">)</span>':n.toHTML(t)})),o={equal:"==",unequal:"!=",smaller:"<",larger:">",smallerEq:"<=",largerEq:">="},i=n[0],a=0;a<this.conditionals.length;a++)i+='<span class="math-operator math-binary-operator math-explicit-binary-operator">'+We(o[this.conditionals[a]])+"</span>"+n[a+1];return i},a.prototype._toTex=function(t){for(var e=t&&t.parenthesis?t.parenthesis:"keep",r=Ut.getPrecedence(this,e),n=this.params.map((function(n,o){var i=Ut.getPrecedence(n,e);return"all"===e||null!==i&&i<=r?"\\left("+n.toTex(t)+"\right)":n.toTex(t)})),o=n[0],i=0;i<this.conditionals.length;i++)o+=oe.operators[this.conditionals[i]]+n[i+1];return o},a}};function Ue(){return(Ue=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}).apply(this,arguments)}var $e={name:"parse",path:"expression",factory:function(t,e,r,n){var o=r(tt),i=r(Dt),a=r(Jt),s=r(Xt),u=r(Qt),c=r(Yt),p=r(se),f=r(he),h=r(ye),l=r(Ne),m=r(je),d=r(Te),y=r(Be),g=r(He),v=r(ze),w=r(Me);function b(e,r){if(1!==arguments.length&&2!==arguments.length)throw new J("parse",arguments.length,1,2);var n=r&&r.nodes?r.nodes:{};if("string"==typeof e)return q(e,n);if(Array.isArray(e)||e instanceof t.Matrix)return X(e,(function(t){if("string"!=typeof t)throw new TypeError("String expected");return q(t,n)}));throw new TypeError("String or matrix expected")}var x=0,N=1,E=2,S=3,O=4,A={",":!0,"(":!0,")":!0,"[":!0,"]":!0,"{":!0,"}":!0,'"':!0,"'":!0,";":!0,"+":!0,"-":!0,"*":!0,".*":!0,"/":!0,"./":!0,"%":!0,"^":!0,".^":!0,"~":!0,"!":!0,"&":!0,"|":!0,"^|":!0,"=":!0,":":!0,"?":!0,"==":!0,"!=":!0,"<":!0,">":!0,"<=":!0,">=":!0,"<<":!0,">>":!0,">>>":!0},j={mod:!0,to:!0,in:!0,and:!0,xor:!0,or:!0,not:!0},T={true:!0,false:!1,null:null,undefined:void 0},k=["NaN","Infinity"];function P(t,e){return t.expression.substr(t.index,e)}function C(t){return P(t,1)}function M(t){t.index++}function F(t){return t.expression.charAt(t.index-1)}function _(t){return t.expression.charAt(t.index+1)}function I(t){for(t.tokenType=x,t.token="",t.comment="";b.isWhitespace(C(t),t.nestingLevel);)M(t);if("#"===C(t))for(;"\n"!==C(t)&&""!==C(t);)t.comment+=C(t),M(t);if(""!==C(t)){if("\n"===C(t)&&!t.nestingLevel)return t.tokenType=N,t.token=C(t),void M(t);var e=C(t),r=P(t,2),n=P(t,3);if(3===n.length&&A[n])return t.tokenType=N,t.token=n,M(t),M(t),void M(t);if(2===r.length&&A[r])return t.tokenType=N,t.token=r,M(t),void M(t);if(A[e])return t.tokenType=N,t.token=e,void M(t);if(b.isDigitDot(e)){if(t.tokenType=E,"."===C(t))t.token+=C(t),M(t),b.isDigit(C(t))||(t.tokenType=N);else{for(;b.isDigit(C(t));)t.token+=C(t),M(t);b.isDecimalMark(C(t),_(t))&&(t.token+=C(t),M(t))}for(;b.isDigit(C(t));)t.token+=C(t),M(t);if("E"===C(t)||"e"===C(t))if(b.isDigit(_(t))||"-"===_(t)||"+"===_(t)){if(t.token+=C(t),M(t),"+"!==C(t)&&"-"!==C(t)||(t.token+=C(t),M(t)),!b.isDigit(C(t)))throw ct(t,'Digit expected, got "'+C(t)+'"');for(;b.isDigit(C(t));)t.token+=C(t),M(t);if(b.isDecimalMark(C(t),_(t)))throw ct(t,'Digit expected, got "'+C(t)+'"')}else if("."===_(t))throw M(t),ct(t,'Digit expected, got "'+C(t)+'"')}else{if(!b.isAlpha(C(t),F(t),_(t))){for(t.tokenType=O;""!==C(t);)t.token+=C(t),M(t);throw ct(t,'Syntax error in part "'+t.token+'"')}for(;b.isAlpha(C(t),F(t),_(t))||b.isDigit(C(t));)t.token+=C(t),M(t);j.hasOwnProperty(t.token)?t.tokenType=N:t.tokenType=S}}else t.tokenType=N}function D(t){do{I(t)}while("\n"===t.token)}function L(t){t.nestingLevel++}function R(t){t.nestingLevel--}function q(t,e){var r={extraNodes:{},expression:"",comment:"",index:0,token:"",tokenType:x,nestingLevel:0,conditionalLevel:null};Ue(r,{expression:t,extraNodes:e}),I(r);var n=function(t){var e,r,n=[];""!==t.token&&"\n"!==t.token&&";"!==t.token&&((e=B(t)).comment=t.comment);for(;"\n"===t.token||";"===t.token;)0===n.length&&e&&(r=";"!==t.token,n.push({node:e,visible:r})),I(t),"\n"!==t.token&&";"!==t.token&&""!==t.token&&((e=B(t)).comment=t.comment,r=";"!==t.token,n.push({node:e,visible:r}));return n.length>0?new u(n):(e||((e=new p(void 0)).comment=t.comment),e)}(r);if(""!==r.token)throw r.tokenType===N?pt(r,"Unexpected operator "+r.token):ct(r,'Unexpected part "'+r.token+'"');return n}function B(e){var r,n,o,i,a=function(t){var e=function(t){var e=H(t);for(;"or"===t.token;)D(t),e=new m("or","or",[e,H(t)]);return e}(t);for(;"?"===t.token;){var r=t.conditionalLevel;t.conditionalLevel=t.nestingLevel,D(t);var n=e,o=B(t);if(":"!==t.token)throw ct(t,"False part of conditional expression expected");t.conditionalLevel=null,D(t);var i=B(t);e=new c(n,o,i),t.conditionalLevel=r}return e}(e);if("="===e.token){if(t.isSymbolNode(a))return r=a.name,D(e),o=B(e),new s(new w(r),o);if(t.isAccessorNode(a))return D(e),o=B(e),new s(a.object,a.index,o);if(t.isFunctionNode(a)&&t.isSymbolNode(a.fn)&&(i=!0,n=[],r=a.name,a.args.forEach((function(e,r){t.isSymbolNode(e)?n[r]=e.name:i=!1})),i))return D(e),o=B(e),new f(r,n,o);throw ct(e,"Invalid left hand side of assignment operator =")}return a}function H(t){for(var e=W(t);"xor"===t.token;)D(t),e=new m("xor","xor",[e,W(t)]);return e}function W(t){for(var e=z(t);"and"===t.token;)D(t),e=new m("and","and",[e,z(t)]);return e}function z(t){for(var e=U(t);"|"===t.token;)D(t),e=new m("|","bitOr",[e,U(t)]);return e}function U(t){for(var e=$(t);"^|"===t.token;)D(t),e=new m("^|","bitXor",[e,$(t)]);return e}function $(t){for(var e=V(t);"&"===t.token;)D(t),e=new m("&","bitAnd",[e,V(t)]);return e}function V(t){for(var e=[Z(t)],r=[],n={"==":"equal","!=":"unequal","<":"smaller",">":"larger","<=":"smallerEq",">=":"largerEq"};n.hasOwnProperty(t.token);){var o={name:t.token,fn:n[t.token]};r.push(o),D(t),e.push(Z(t))}return 1===e.length?e[0]:2===e.length?new m(r[0].name,r[0].fn,e):new v(r.map((function(t){return t.fn})),e)}function Z(t){var e,r,n,o,i;for(e=G(t),r={"<<":"leftShift",">>":"rightArithShift",">>>":"rightLogShift"};r.hasOwnProperty(t.token);)o=r[n=t.token],D(t),i=[e,G(t)],e=new m(n,o,i);return e}function G(t){var e,r,n,o,i;for(e=K(t),r={to:"to",in:"to"};r.hasOwnProperty(t.token);)o=r[n=t.token],D(t),"in"===n&&""===t.token?e=new m("*","multiply",[e,new w("in")],!0):(i=[e,K(t)],e=new m(n,o,i));return e}function K(t){var e,r=[];if(e=":"===t.token?new p(1):Q(t),":"===t.token&&t.conditionalLevel!==t.nestingLevel){for(r.push(e);":"===t.token&&r.length<3;)D(t),")"===t.token||"]"===t.token||","===t.token||""===t.token?r.push(new w("end")):r.push(Q(t));e=3===r.length?new g(r[0],r[2],r[1]):new g(r[0],r[1])}return e}function Q(t){var e,r,n,o,i;for(e=Y(t),r={"+":"add","-":"subtract"};r.hasOwnProperty(t.token);)o=r[n=t.token],D(t),i=[e,Y(t)],e=new m(n,o,i);return e}function Y(t){var e,r,n,o,i;for(r=e=et(t),n={"*":"multiply",".*":"dotMultiply","/":"divide","./":"dotDivide","%":"mod",mod:"mod"};n.hasOwnProperty(t.token);)i=n[o=t.token],D(t),r=et(t),e=new m(o,i,[e,r]);return e}function et(e){var r,n;for(n=r=rt(e);e.tokenType===S||"in"===e.token&&t.isConstantNode(r)||!(e.tokenType!==E||t.isConstantNode(n)||t.isOperatorNode(n)&&"!"!==n.op)||"("===e.token;)n=rt(e),r=new m("*","multiply",[r,n],!0);return r}function rt(e){for(var r=nt(e),n=r,o=[];"/"===e.token&&t.isConstantNode(n);){if(o.push(Ue({},e)),D(e),e.tokenType!==E){Ue(e,o.pop());break}if(o.push(Ue({},e)),D(e),e.tokenType!==S&&"("!==e.token){o.pop(),Ue(e,o.pop());break}Ue(e,o.pop()),o.pop(),n=nt(e),r=new m("/","divide",[r,n])}return r}function nt(t){var r,n,i,s={"-":"unaryMinus","+":"unaryPlus","~":"bitNot",not:"not"};return s.hasOwnProperty(t.token)?(i=s[t.token],r=t.token,D(t),n=[nt(t)],new m(r,i,n)):function(t){var r,n,i,s;r=function(t){var r,n,i,s;r=function(t){var r=[];if(t.tokenType===S&&t.extraNodes.hasOwnProperty(t.token)){var n=t.extraNodes[t.token];if(I(t),"("===t.token){if(r=[],L(t),I(t),")"!==t.token)for(r.push(B(t));","===t.token;)I(t),r.push(B(t));if(")"!==t.token)throw ct(t,"Parenthesis ) expected");R(t),I(t)}return new n(r)}return function(t){var r,n;if(t.tokenType===S||t.tokenType===N&&t.token in j)return n=t.token,I(t),r=T.hasOwnProperty(n)?new p(T[n]):-1!==k.indexOf(n)?new p(o(n,"number")):new w(n),r=ot(t,r);return function(t){var r,n;if('"'===t.token)return n=it(t),r=new p(n),r=ot(t,r);return function(t){var r,n;if("'"===t.token)return n=at(t),r=new p(n),r=ot(t,r);return function(t){var r,n,i,s;if("["===t.token){if(L(t),I(t),"]"!==t.token){var u=st(t);if(";"===t.token){for(i=1,n=[u];";"===t.token;)I(t),n[i]=st(t),i++;if("]"!==t.token)throw ct(t,"End of matrix ] expected");R(t),I(t),s=n[0].items.length;for(var c=1;c<i;c++)if(n[c].items.length!==s)throw pt(t,"Column dimensions mismatch ("+n[c].items.length+" !== "+s+")");r=new a(n)}else{if("]"!==t.token)throw ct(t,"End of matrix ] expected");R(t),I(t),r=u}}else R(t),I(t),r=new a([]);return ot(t,r)}return function(t){if("{"===t.token){var r;L(t);var n={};do{if(I(t),"}"!==t.token){if('"'===t.token)r=it(t);else if("'"===t.token)r=at(t);else{if(t.tokenType!==S)throw ct(t,"Symbol or string expected as object key");r=t.token,I(t)}if(":"!==t.token)throw ct(t,"Colon : expected after object key");I(t),n[r]=B(t)}}while(","===t.token);if("}"!==t.token)throw ct(t,"Comma , or bracket } expected after object value");R(t),I(t);var i=new l(n);return i=ot(t,i)}return function(t){var r;if(t.tokenType===E)return r=t.token,I(t),new p(o(r,e.number));return function(t){var e;if("("===t.token){if(L(t),I(t),e=B(t),")"!==t.token)throw ct(t,"Parenthesis ) expected");return R(t),I(t),e=new d(e),e=ot(t,e)}return function(t){throw""===t.token?ct(t,"Unexpected end of expression"):ct(t,"Value expected")}(t)}(t)}(t)}(t)}(t)}(t)}(t)}(t)}(t),n={"!":"factorial","'":"ctranspose"};for(;n.hasOwnProperty(t.token);)i=t.token,s=n[i],I(t),r=new m(i,s,[r]),r=ot(t,r);return r}(t),("^"===t.token||".^"===t.token)&&(n=t.token,i="^"===n?"pow":"dotPow",D(t),s=[r,nt(t)],r=new m(n,i,s));return r}(t)}function ot(e,r,n){for(var o;!("("!==e.token&&"["!==e.token&&"."!==e.token||n&&-1===n.indexOf(e.token));)if(o=[],"("===e.token){if(!t.isSymbolNode(r)&&!t.isAccessorNode(r))return r;if(L(e),I(e),")"!==e.token)for(o.push(B(e));","===e.token;)I(e),o.push(B(e));if(")"!==e.token)throw ct(e,"Parenthesis ) expected");R(e),I(e),r=new y(r,o)}else if("["===e.token){if(L(e),I(e),"]"!==e.token)for(o.push(B(e));","===e.token;)I(e),o.push(B(e));if("]"!==e.token)throw ct(e,"Parenthesis ] expected");R(e),I(e),r=new i(r,new h(o))}else{if(I(e),e.tokenType!==S)throw ct(e,"Property name expected after dot");o.push(new p(e.token)),I(e);r=new i(r,new h(o,!0))}return r}function it(t){for(var e="";""!==C(t)&&'"'!==C(t);)"\\"===C(t)&&(e+=C(t),M(t)),e+=C(t),M(t);if(I(t),'"'!==t.token)throw ct(t,'End of string " expected');return I(t),JSON.parse('"'+e+'"')}function at(t){for(var e="";""!==C(t)&&"'"!==C(t);)"\\"===C(t)&&(e+=C(t),M(t)),e+=C(t),M(t);if(I(t),"'"!==t.token)throw ct(t,"End of string ' expected");return I(t),JSON.parse('"'+e+'"')}function st(t){for(var e=[B(t)],r=1;","===t.token;)I(t),e[r]=B(t),r++;return new a(e)}function ut(t){return t.index-t.token.length+1}function ct(t,e){var r=ut(t),n=new SyntaxError(e+" (char "+r+")");return n.char=r,n}function pt(t,e){var r=ut(t),n=new SyntaxError(e+" (char "+r+")");return n.char=r,n}return b.isAlpha=function(t,e,r){return b.isValidLatinOrGreek(t)||b.isValidMathSymbol(t,r)||b.isValidMathSymbol(e,t)},b.isValidLatinOrGreek=function(t){return/^[a-zA-Z_$\u00C0-\u02AF\u0370-\u03FF\u2100-\u214F]$/.test(t)},b.isValidMathSymbol=function(t,e){return/^[\uD835]$/.test(t)&&/^[\uDC00-\uDFFF]$/.test(e)&&/^[^\uDC55\uDC9D\uDCA0\uDCA1\uDCA3\uDCA4\uDCA7\uDCA8\uDCAD\uDCBA\uDCBC\uDCC4\uDD06\uDD0B\uDD0C\uDD15\uDD1D\uDD3A\uDD3F\uDD45\uDD47-\uDD49\uDD51\uDEA6\uDEA7\uDFCC\uDFCD]$/.test(e)},b.isWhitespace=function(t,e){return" "===t||"\t"===t||"\n"===t&&e>0},b.isDecimalMark=function(t,e){return"."===t&&"/"!==e&&"*"!==e&&"^"!==e},b.isDigitDot=function(t){return t>="0"&&t<="9"||"."===t},b.isDigit=function(t){return t>="0"&&t<="9"},b}};var Ve={name:"parse",factory:function(t,e,r,n){var o=r($e);return n("parse",{"string | Array | Matrix":o,"string | Array | Matrix, Object":o})}};var Xe={name:"compile",factory:function(t,e,r,n){var o=r($e);return n("compile",{string:function(t){return o(t).compile()},"Array | Matrix":function(t){return X(t,(function(t){return o(t).compile()}))}})}};var Ze={name:"eval",factory:function(t,e,r,n){var o=r($e);return n("compile",{string:function(t){return o(t).compile().eval({})},"string, Object":function(t,e){return o(t).compile().eval(e)},"Array | Matrix":function(t){var e={};return X(t,(function(t){return o(t).compile().eval(e)}))},"Array | Matrix, Object":function(t,e){return X(t,(function(t){return o(t).compile().eval(e)}))}})}};var Ge={name:"format",factory:function(t,e,r,n){var o=n("format",{any:vt.format,"any, Object | function | number":vt.format});return o.toTex=void 0,o}},Ke=V.create();Ke.import(Ve),Ke.import(Xe),Ke.import(Ze),Ke.import(Ge),Ke.import({add:function(t,e){return t+e},subtract:function(t,e){return t-e},multiply:function(t,e){return t*e},divide:function(t,e){return t/e},mod:function(t,e){return t%e},unaryPlus:function(t){return t},unaryMinus:function(t){return-t},bitOr:function(t,e){return t|e},bitXor:function(t,e){return t^e},bitAnd:function(t,e){return t&e},bitNot:function(t){return~t},leftShift:function(t,e){return t<<e},rightArithShift:function(t,e){return t>>e},rightLogShift:function(t,e){return t>>>e},or:function(t,e){return!(!t&&!e)},xor:function(t,e){return!!t!=!!e},and:function(t,e){return!(!t||!e)},not:function(t){return!t},equal:function(t,e){return t==e},unequal:function(t,e){return t!=e},smaller:function(t,e){return t<e},larger:function(t,e){return t>e},smallerEq:function(t,e){return t<=e},largerEq:function(t,e){return t>=e},matrix:function(){throw new Error("Matrices not supported")},index:function(){throw new Error("Matrix indexes not supported")},pi:Math.PI,e:Math.E,true:!0,false:!1,null:null});var Qe={};Object.getOwnPropertyNames(Math).forEach((function(t){Object.prototype.hasOwnProperty(t)||(Qe[t]=Math[t])})),Ke.import(Qe);var Ye=Ke;const tr=(()=>{const t=e=>{if(Array.isArray(e))return e.map(e=>t(e));if(e instanceof Object)if("dice"===e.type){let r=t(e.sides);r=Array.isArray(r)?r.join(""):r;let n=t(e.qty);switch(n=Ye.eval(Array.isArray(n)?n.join(""):n),e.modifiers=Object.assign({},...Object.keys(e.modifiers).map(r=>({[r]:t(e.modifiers[r])}))),e.subType){case"standard":return new f(e.notation,Ye.eval(r),n,e.modifiers);case"percentile":return new l(e.notation,n,e.modifiers);case"fudge":return new h(e.notation,Ye.eval(r),n,e.modifiers);default:throw Error("Parser: Dice type was not recognised")}}else{if("group"===e.type)return e.expressions=t(e.expressions),e.modifiers=Object.assign({},...Object.keys(e.modifiers).map(r=>({[r]:t(e.modifiers[r])}))),new N(e.notation,e.expressions,e.modifiers);if("modifier"===e.type)switch(e.subType){case"drop":return new v(e.notation,e.end,e.qty);case"explode":return e.comparePoint=t(e.comparePoint),new u(e.notation,e.comparePoint,e.compound,e.penetrate);case"keep":return new g(e.notation,e.end,e.qty);case"target":return e.successCP=t(e.successCP),e.failureCP=e.failureCP?t(e.failureCP):null,new b(e.notation,e.successCP,e.failureCP);case"re-roll":return e.comparePoint=t(e.comparePoint),new p(e.notation,e.once,e.comparePoint);case"critical-success":return e.comparePoint=t(e.comparePoint),new y(e.notation,e.comparePoint);case"critical-failure":return e.comparePoint=t(e.comparePoint),new d(e.notation,e.comparePoint);case"sort":return new w(e.notation,e.direction)}else if("compare-point"===e.type)return new i(e.operator,e.value)}return e};return class{static parse(r){if(!r)throw Error("Notation is required");if("string"!=typeof r)throw Error("Notation must be a string");const n=e(r);return t(n)}}})(),er=(()=>{const t=Symbol("calculateTotals"),e=Symbol("notation"),o=Symbol("parsed-notation"),i=Symbol("rolls"),a=Symbol("totals");class s{constructor(t){if(!t)throw new Error("Notation is required");if(this[o]=[],t instanceof Object&&!Array.isArray(t)){if(!t.notation)throw new Error("Notation is required");if("string"!=typeof t.notation)throw new Error("Notation is not valid: "+t.notation);if(t.rolls){if(!Array.isArray(t.rolls))throw new Error("Rolls must be an Array: "+t.rolls);this[i]=t.rolls.map(t=>t instanceof c?t:Array.isArray(t)?new c(t):t instanceof Object&&Array.isArray(t.rolls)?new c(t.rolls):void 0)}this[e]=t.notation,this[o]=tr.parse(this.notation),this[i]&&this[i].length||(this[i]=[],this.roll())}else{if("string"!=typeof t)throw new Error("Notation is not valid: "+t);this[e]=t,this[i]=[],this[o]=tr.parse(this.notation),this.roll()}}static import(t){if(t){if(r.isJson(t))return s.import(JSON.parse(t));if(r.isBase64(t))return s.import(atob(t));if("object"==typeof t)return t instanceof s?t:new s(t);throw new Error("Unrecognised import format for data: "+t)}throw new Error("No data to import")}get notation(){return this[e]||""}get output(){let t=0,e=this.notation+": ";return this.hasRolls()?(e+=this[o].map(e=>{if(e instanceof f){const e=this.rolls[t]||null;return t++,e}return e}).filter(Boolean).join(""),e+=" = "+this.total):e+="No dice rolled",e}get rolls(){return this[i]||[]}get total(){return!this[a]&&this.hasRolls()&&(this[a]=this[t]()),this[a]||0}export(t=n.JSON){switch(t){case n.BASE_64:return btoa(this.export(n.JSON));case n.JSON:return JSON.stringify(this);case n.OBJECT:return JSON.parse(this.export(n.JSON));default:throw new Error("Unrecognised export format: "+t)}}hasRolls(){return!!(this[o]&&Array.isArray(this.rolls)&&this.rolls.length)}roll(){return this[i]=[],this[a]=0,this[i]=this[o].map(t=>{if(t instanceof f||t instanceof N)return t.roll()}).filter(Boolean),this[i]}toJSON(){const{notation:t,output:e,rolls:r,total:n}=this;return{notation:t,output:e,rolls:r,total:n,type:"dice-roll"}}toString(){return this.output}[t](){let t="",e=0;return this.hasRolls()&&this[o].forEach(r=>{r instanceof f?(t+=this.rolls[e]?this.rolls[e].value:0,e++):t+=r}),t?r.toFixed(Ye.eval(t),2):0}}return s})(),rr=(()=>{const t=Symbol("log");class e{constructor(e){if(this[t]=[],e)if(Array.isArray(e.log))e.log.forEach(e=>{this[t].push(er.import(e))});else if(e.log)throw new Error("DiceRoller: Roll log must be an Array")}get log(){return this[t]||[]}get output(){return this.log.join("; ")}get total(){return this.log.reduce((t,e)=>t+e.total,0)}static import(t){const r=new e;return r.import(t),r}clearLog(){this[t].length=0}export(t){switch(t||n.JSON){case n.BASE_64:return btoa(this.export(n.JSON));case n.JSON:return JSON.stringify(this);case n.OBJECT:return JSON.parse(this.export(n.JSON));default:throw new Error("Unrecognised export format: "+t)}}import(e){if(e){if(r.isJson(e))return this.import(JSON.parse(e));if(r.isBase64(e))return this.import(atob(e));if("object"==typeof e){if(!e.log&&Array.isArray(e)&&e.length&&(e={log:e}),e.log&&Array.isArray(e.log))e.log.forEach(e=>{this[t].push(er.import(e))});else if(e.log)throw new Error("Roll log must be an Array");return this.log}throw new Error("Unrecognised import format for data: "+e)}throw new Error("No data to import")}toJSON(){const{log:t,output:e,total:r}=this;return{log:t,output:e,total:r,type:"dice-roller"}}toString(){return this.output}roll(...e){if(!e||!e.length)throw new Error("No notations specified");const r=e.filter(Boolean);if(!r.length)throw new Error("No notations specified");const n=r.map(e=>{let r=new er(e);return this[t].push(r),r});return n.length>1?n:n[0]}}return e})();export{m as Dice,er as DiceRoll,rr as DiceRoller,x as Modifiers,tr as Parser,r as diceUtils,n as exportFormats};