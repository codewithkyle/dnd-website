import{env as e}from"./env.mjs";import{djinnjsOutDir as t,usePercentage as n}from"./config.mjs";export function fetchJS(n){return new Promise(o=>{const r=e.startLoading(),i=n instanceof Array?n:[n];0===i.length&&(e.stopLoading(r),o());let l=0;for(let n=0;n<i.length;n++){const d=i[n],a=new RegExp(/^(http)/i).test(i[n]);let s=document.head.querySelector(`script[src="${i[n]}"]`)||document.head.querySelector(`script[file="${d}"]`)||null;s?(l++,l===i.length&&(e.stopLoading(r),o())):(s=document.createElement("script"),a||s.setAttribute("file",""+d),s.type="module",a?s.src=i[n]:d.match(/(\..*)$/gi)?s.src=`${window.location.origin}/${t}/${d}`:s.src=`${window.location.origin}/${t}/${d}.mjs`,s.addEventListener("load",()=>{l++,l===i.length&&(e.stopLoading(r),o())}),s.addEventListener("error",()=>{l++,l===i.length&&(e.stopLoading(r),o())}),document.head.append(s))}})}export function fetchCSS(o){return new Promise(r=>{const i=e.startLoading(),l=o instanceof Array?o:[o];0===l.length&&(e.stopLoading(i),r());const d=document.body.querySelector("djinnjs-file-loading-value")||null;let a=0;for(let o=0;o<l.length;o++){const s=l[o].replace(/(\.css)$/gi,""),c=new RegExp(/^(http)/gi).test(s);let g=document.head.querySelector(`link[file="${s}.css"]`)||document.head.querySelector(`link[href="${s}"]`)||null;g?(a++,"hard-loading"===e.domState&&d&&(d.innerHTML=n?Math.round(a/l.length*100)+"%":`${a}/${l.length}`),a===l.length&&(e.stopLoading(i),r())):(g=document.createElement("link"),c||g.setAttribute("file",s+".css"),g.rel="stylesheet",g.href=c?s+".css":`${window.location.origin}/${t}/${s}.css`,g.addEventListener("load",()=>{a++,"hard-loading"===e.domState&&d&&(d.innerHTML=n?Math.round(a/l.length*100)+"%":`${a}/${l.length}`),a===l.length&&(e.stopLoading(i),r())}),g.addEventListener("error",()=>{a++,"hard-loading"===e.domState&&d&&(d.innerHTML=n?Math.round(a/l.length*100)+"%":`${a}/${l.length}`),a===l.length&&(e.stopLoading(i),r())}),document.head.append(g))}})}