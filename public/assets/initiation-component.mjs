import{EntityComponent as e}from"./entity-component.mjs";import{message as t}from"./broadcaster.mjs";import{snackbar as i}from"./notifyjs.mjs";import{uid as r}from"./uid.mjs";class n extends HTMLElement{constructor(){super(),this.addEntityComponent=()=>{const e=document.importNode(this.entityComponentTemplate.content,!0),t=e.querySelector("entity-component");t.style.order=""+this.entities.length,t.dataset.uid=r(),this.entityWrapper.appendChild(e),this.entities=Array.from(this.querySelectorAll("entity-wrapper entity-component"))},this.updateOrder=()=>{this.entities=Array.from(this.querySelectorAll("entity-wrapper entity-component"));const e=[];let r,n,o,s=!1,l=0;for(let t=0;t<this.entities.length;t++){const i=this.entities[t].querySelector(".js-initiation").value;if(""===i){s=!0,l=1;break}const a={el:this.entities[t],value:parseInt(i)};if(0===t)e.push(a);else{let t=null;for(let i=0;i<e.length;i++){if(a.value>e[i].value){t=i;break}if(a.value===e[i].value){s=!0,n=a.el.querySelector(".js-name").value,o=e[i].el.querySelector(".js-name").value,r=a.value,l=2;break}}if(s)break;null===t?e.push(a):e.splice(t,0,a)}}if(s&&1===l)return void i({message:"Initiation order values cannot be blank.",closeable:!0,force:!0});if(s&&2===l)return void i({message:`Invalid initation order. ${n} and ${o} both rolled a ${r}`,closeable:!0,force:!0});const a=[];for(let t=0;t<e.length;t++)e[t].el.style.order=t,a.push({name:e[t].el.querySelector(".js-name").value,uid:e[t].el.dataset.uid});t("server",{type:"initiation-order",entities:a})},this.clearOrder=()=>{t("server",{type:"clear-order"});for(let e=0;e<this.entities.length;e++)this.entities[e].style.order="",this.entities[e].querySelector(".js-initiation").value=""},this.entities=Array.from(this.querySelectorAll("entity-wrapper entity-component")),this.entityComponentTemplate=this.querySelector('template[tag="entity-component"]'),this.entityWrapper=this.querySelector("entity-wrapper")}connectedCallback(){this.querySelector(".js-add-entity").addEventListener("click",this.addEntityComponent),this.querySelector(".js-update-initiation-order").addEventListener("click",this.updateOrder),this.querySelector(".js-clear-order").addEventListener("click",this.clearOrder)}}customElements.define("initiation-component",n),customElements.define("entity-component",e);